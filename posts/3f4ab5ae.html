<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>李晓黎_《Go语言Hyperledger区块链开发实战》 | 水木时</title><meta name="author" content="水木时"><meta name="copyright" content="水木时"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="ffffff"><meta name="description" content="知识记录 交易流程 详细的交易过程  (1)提案&#x2F;背书 在提案&#x2F;背书阶段,客户端应用会发送一个交易提案到一组Peer节点,Peer节点会调用智能合约发起一个更新账本的申请，然后对结果进行背书。此时，背书Peer节点不会将更新提案应用到自己的账本副本中，而是会将背书的结果返回至客户端应用。背书结果中包含背书节点的签名和对应的带有版本号的交易数据读&#x2F;写集。 客户端应用如果收集了策略中规定的足够数量的背">
<meta property="og:type" content="article">
<meta property="og:title" content="李晓黎_《Go语言Hyperledger区块链开发实战》">
<meta property="og:url" content="https://timefy.github.io/posts/3f4ab5ae.html">
<meta property="og:site_name" content="水木时">
<meta property="og:description" content="知识记录 交易流程 详细的交易过程  (1)提案&#x2F;背书 在提案&#x2F;背书阶段,客户端应用会发送一个交易提案到一组Peer节点,Peer节点会调用智能合约发起一个更新账本的申请，然后对结果进行背书。此时，背书Peer节点不会将更新提案应用到自己的账本副本中，而是会将背书的结果返回至客户端应用。背书结果中包含背书节点的签名和对应的带有版本号的交易数据读&#x2F;写集。 客户端应用如果收集了策略中规定的足够数量的背">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://timefy.github.io/img/img/23.jpg">
<meta property="article:published_time" content="2024-06-19T03:17:29.000Z">
<meta property="article:modified_time" content="2024-07-08T04:04:25.513Z">
<meta property="article:author" content="水木时">
<meta property="article:tag" content="杂记">
<meta property="article:tag" content="区块链">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://timefy.github.io/img/img/23.jpg"><link rel="shortcut icon" href="/img/inc.jpg"><link rel="canonical" href="https://timefy.github.io/posts/3f4ab5ae.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="google-site-verification" content="_x0dyaKpFOJCV80Mg6gwOuNliEsuReuksBXZTgUHRNs"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"top_n_per_article":1,"unescape":true,"languages":{"hits_empty":"找不到您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: true,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '李晓黎_《Go语言Hyperledger区块链开发实战》',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-07-08 12:04:25'
}</script><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
        if (t === 'dark') activateDarkMode()
        else if (t === 'light') activateLightMode()
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><!-- hexo injector head_end start --><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Zfour/Butterfly-double-row-display@1.00/cardlistpost.min.css"/>
<style>#recent-posts > .recent-post-item >.recent-post-info > .article-meta-wrap > .tags:before {content:"\A";
  white-space: pre;}#recent-posts > .recent-post-item >.recent-post-info > .article-meta-wrap > .tags > .article-meta__separator{display:none}</style>
<!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.3.0"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/img.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">25</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">16</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">5</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/categories/%E5%8C%BA%E5%9D%97%E9%93%BE"><i class="fa-fw fas fa-cubes"></i><span> 区块链</span></a></div><div class="menus_item"><a class="site-page" href="/posts/6bcdfa14.html"><i class="fa-fw fas fa-user-edit"></i><span> 区块链笔记</span></a></div><div class="menus_item"><a class="site-page" href="/posts/776f3c45.html"><i class="fa-fw fas fa-user-shield"></i><span> 隐私保护笔记</span></a></div><div class="menus_item"><a class="site-page" href="/categories/web%E5%AE%89%E5%85%A8"><i class="fa-fw fa-solid fa-shield-cat"></i><span> Web安全</span></a></div><div class="menus_item"><a class="site-page" href="/categories/%E9%98%85%E8%AF%BB"><i class="fa-fw fas fa-book"></i><span> 阅读</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 侧栏</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background: transparent"><nav id="nav"><span id="blog-info"><a href="/" title="水木时"><span class="site-name">水木时</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/categories/%E5%8C%BA%E5%9D%97%E9%93%BE"><i class="fa-fw fas fa-cubes"></i><span> 区块链</span></a></div><div class="menus_item"><a class="site-page" href="/posts/6bcdfa14.html"><i class="fa-fw fas fa-user-edit"></i><span> 区块链笔记</span></a></div><div class="menus_item"><a class="site-page" href="/posts/776f3c45.html"><i class="fa-fw fas fa-user-shield"></i><span> 隐私保护笔记</span></a></div><div class="menus_item"><a class="site-page" href="/categories/web%E5%AE%89%E5%85%A8"><i class="fa-fw fa-solid fa-shield-cat"></i><span> Web安全</span></a></div><div class="menus_item"><a class="site-page" href="/categories/%E9%98%85%E8%AF%BB"><i class="fa-fw fas fa-book"></i><span> 阅读</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 侧栏</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></li></ul></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">李晓黎_《Go语言Hyperledger区块链开发实战》</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2024-06-19T03:17:29.000Z" title="发表于 2024-06-19 11:17:29">2024-06-19</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-07-08T04:04:25.513Z" title="更新于 2024-07-08 12:04:25">2024-07-08</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/">区块链</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">17.1k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>71分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="李晓黎_《Go语言Hyperledger区块链开发实战》"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1>知识记录</h1>
<h2 id="交易流程">交易流程</h2>
<h3 id="详细的交易过程">详细的交易过程</h3>
<p><img src="/img/go_hyperledger/1.jpg" alt=""></p>
<p><strong>(1)提案/背书</strong></p>
<p>在提案/背书阶段,客户端应用会发送一个交易提案到一组Peer节点,Peer节点会调用智能合约发起一个更新账本的申请，然后对结果进行背书。此时，背书Peer节点不会将更新提案应用到自己的账本副本中，而是会将背书的结果返回至客户端应用。背书结果中包含背书节点的签名和对应的带有版本号的交易数据读/写集。</p>
<p>客户端应用如果收集了策略中规定的足够数量的背书，则将交易发送至排序服务</p>
<p><strong>(2)排序/打包</strong><br>
在交易的第2阶段，排序服务会通过共识协议对交易进行排序。在Fabric网络中，共识协议是可插拔的，即可以从多个配置好的共识协议中选择使用其中的一个，并且可以动态增加共识协议。</p>
<p>排序服务从不同的客户端接收交易，并按通道对它们进行排序。排序服务不需要查看交易的内容，也不会执行交易的操作。排序服务可以为每个通道的交易创建区块，将交易打包到区块，并使用自己的数字证书为区块签名，然后利用Gossip 协议将签名后的区块向所有 Peer 节点广播。</p>
<p><strong>(3)验证/记账</strong></p>
<p>根据应用程序在提交交易到账本之前指定的背书策略对交易进行验证。应用程序指定的背书策略中包括需要哪个Peer节点或需要多少个Peer节点对给定智能合约的正确执行提供担保。每个交易都需要经过背书策略中指定数量的Peer节点进行背书。如果要求多个Peer节点对交易进行背书，则并发执行背书可以提高系统的性能。</p>
<p>所有的 Peer节点都会从排序服务接收到经过排序的区块。Peer节点会验证排序服务对区块的签名，然后对读集合中的数据进行验证，以判断交易是否有效。每个有效的区块都会被写入区块链账本中。区块中每个交易中的写集合都会被更新到状态数据库中。</p>
<h3 id="完整的交易过程">完整的交易过程</h3>
<p><img src="/img/go_hyperledger/2.jpg" alt=""></p>
<p><strong>(1)客户端初始化交易</strong></p>
<p>在Fabric网络中交易由客户端应用发起,发起交易的方式是向背书节点发送交易提案。提案是向通道上指定的Peer 节点提出的背书请求。提案可以是初始化(init)请求，也可以是读/写请求。</p>
<p>可以使用Fabric SDK构造交易提案。交易提案的作用是请求调用一个链码，以便读写账本。Fabric SDK是一个将请求绑定到对应程序包的进程。SDK持有客户端的数字证书因此为客户端所接受，可以代表客户端对其发起的交易提案进行签名，然后向选择的背书节点发送请求。</p>
<p>在发送交易提案到背书节点前，客户端SDK需要知道网络中所有背书节点的列表。在图2-8中有5个背书节点，分别是P12、P14、P22、P24和P32。背书节点在配置文件 confgtx.yaml 中定义，confgtx.yaml中保存着前文提到的背书策略。</p>
<p>每个背书节点上都安装了一个链码，还存储着一个账本副本。所有Peer 节点上的账本副本都保持同步。</p>
<p><strong>(2)背书节点验证签名并执行交易</strong></p>
<p>背书是指定 Peer 节点执行链码交易并对客户端应用的交易提案返回一个“提案响应”的处理过程。提案响应中包括执行链码的响应信息、结果(读集合和写集合)、事件，以及作为Peer 节点执行链码证据的数字签名。</p>
<p>链码应用程序应符合背书策略。背书策略可以指定如下配置信息。</p>
<ul>
<li>背书节点：指通道中必须执行特定交易的Peer节点。这些特定交易都与特定链码应用程序绑定在一起。</li>
<li>交易被接受的前提条件：比如要求交易得到最少数量背书节点的背书、最小百分比背书节点的背书或分配给特定链码应用程序的所有背书节点的背书。</li>
</ul>
<p>有些背书节点可能已经离线工、其余的背书节点在收到交易提案后，会按照事先定义好的步骤对交易进行验证，具体如下。</p>
<ul>
<li>交易提案消息是否符合要求。</li>
<li>交易提案之前有没有被记账过。</li>
<li>签名是否有效。</li>
<li>提交交易提案的客户端是否有权限在当前通道上执行交易。</li>
</ul>
<p>背书节点会以交易提案作为参数调用链码的函数，链码会基于数据库的当前状态执行模拟交易，并得到交易的结果。交易结果包括链码的响应值和交易的读/写集。读/写集中包含模拟交易时从当前状态数据库中读取的数据，以及执行交易时向状态数据库中写入的数据。此步骤中并不实际更新账本，读/写集和背书节点的签名将作为提案响应返回SDK。</p>
<p><strong>(3)检查提案响应</strong></p>
<p>客户端应用在收到所有背书节点的响应后，对背书响应列表进行验证，检查其是否满足背书策略的规则。不同的通道拥有不同的背书策略。</p>
<p>客户端应用会对背书节点的签名进行有效性校验。如果链码只希望查询账本，则客户端应用将检查查询响应，而不会将交易提交至排序服务。在交易发送至排序服务之前，客户端应用会检查提案响应以确保满足指定的背书策略的规则。</p>
<p><strong>(4)客户端将背书信息集成到交易中</strong><br>
背书响应通过验证后，客户端应用会将其发送到合适的排序服务。背书信息最终会出现在区块中。在图2-8所示的示例网络中由组织Org2和Org3提供的两个排序节点组成排序服务。在生产网络中，通常会启动多个排序节点，以防出现故障影响网络的正常运行。</p>
<p>SDK会将交易提案和背书响应都封装到交易信息中，然后将其发送至排序服务。发送至排序服务的交易信息中包含以下信息。</p>
<ul>
<li>模拟交易时产生的读/写集。</li>
<li>背书节点的签名。</li>
<li>通道 ID。</li>
</ul>
<p>排序服务并不会对交易信息中的所有信息进行检查，而只会从网络的所有通道中接收所有交易，然后按时间对它们进行排序，为每个通道创建一个区块，用于存储该通道的交易。</p>
<p>对交易的排序在网络范围内进行,不同应用程的交易背书和提交的读写集会同时被排序。</p>
<p>排序服务由一组排序节点组成，它并不对交易和智能合约进行处理，也不维护共享账本，排序服务接收经过背书的交易，并为这些交易指定一个记账节点，由记账节点将这些交易写入账本中。</p>
<p><strong>(5)验证交易</strong><br>
当区块被经过排序的交易填满后,它会被发送至网络中的领导节点。理想状态下,Fabric网络中应该有一个领导节点，但是这并不是强制要求。如果没有领导节点，则排序节点需夏逐一确认此区块已经被传送至所有的记账节点，这样做会增加网络的负载。为了避免这种情况，联盟中的每个组织都会提名自己的领导节点。每个组织可以有多个领导节点，以防止出现故障。有的组织如果只有一个领导节点，而且该领导节点没有对请求做出响应则会在活动的 Peer 节点中启动一个投票机制，选举新的领导节点。</p>
<p>借助通道，所有的排序节点都可以得到通道中的领导节点列表。排序节点会将准备好的区块发送至所有活动的领导节点。</p>
<p>领导节点会将区块发送给同一组织内的其他记账节点。区块会通过Gossip协议而被传送至通道中的所有Peer 节点。区块中的交易会被验证以确认如下事项。</p>
<ul>
<li>满足背书策略的规则。</li>
<li>从交易执行生成读集合后，读集合中的变量与账本状态相比并没有发生变化</li>
</ul>
<p>根据验证的结果，区块中的交易会被标记为有效或无效。</p>
<p><strong>(6)更新账本</strong></p>
<p>Peer 节点会根据链码的策略检查背书是否有效，同时要对读/写集进行检查，判断其是否与世界状态数据一致;特别是当背书节点模拟交易时，需要判断已经存在的读数据是否与世界状态数据一致。</p>
<p>当记账节点完成验证交易后,交易将会被写入账本中(也就是将区块追加到区块链中)，并使用读/写集中的写数据更新状态数据库。</p>
<p>每个Peer 节点均可与多个通道相关联。因此，在Fabric 网络中可以存在多个区块链。</p>
<p>最后，每个记账节点都会将交易记账的结果异步通知到发起交易的客户端应用。</p>
<h3 id="带有私有数据的交易流">带有私有数据的交易流</h3>
<p>(1)客户端应用提交一个提案请求，调用链码中读取或写入私有数据的函数。只有私有数据集中经过授权的 Peer 节点上的链码才能访问私有数据。</p>
<p>(2)私有数据或在链码中用于生成私有数据的数据包含在提案的transient 字段中transient 字段的作用是防止私有数据被记录在区块中,具体情况将在9.6节结合私有数据编程进行介绍。</p>
<p>(3)背书节点会模拟交易并将私有数据存储在一个临时的数据存储区中，然后基于集合策略(通过 Gossip 协议)将私有数据分发给经过授权的Peer节点。</p>
<p>(4)背书节点会向客户端发送背书响应，其中包含公有数据和所有私有数据的键和值的哈希值。</p>
<p>(5)客户端应用向排序服务提交交易,交易数据中包含提案响应和私有数据的哈希值带有私有数据哈希值的交易和普通交易一样，都会被包含在区块中。这样，通道中所有的Peer 节点都可以对交易数据进行验证，而且不知道真正的私有数据。</p>
<p>(6)在写入区块时，Peer 节点依据集合策略来决定自己是否有权限访问私有数据。如果有权限，则首先检查自己的临时数据存储区，并判断在链码背书时是否已经接收到私有数据。如果没有权限，则从其他经过授权的Peer节点那里拉取私有数据的哈希值，然后将其与区块中私有数据的哈希值进行比较，校验交易的有效性。经过验证和写入阶段，私有数据已被存储在 Peer 节点的私有状态数据库及其私有写集合中。最后，私有数据会从临时数据存储区中被删除。</p>
<h3 id="交易模拟和读-写集">交易模拟和读/写集</h3>
<p>在对交易进行背书时，有一个模拟交易的过程。在此过程中会生成交易的读/写集。读集合中包含一组唯一的关键字和它们的版本(注意不是由键和键的值数据所组成的键值对,而是由键和版本号组成的数据)，以记录模拟过程中所读取的数据;写集合中包含一组唯-的关键字及它们的新值，新值就是在交易过程中写入区块链的值。如果交易删除某个关键字,则在写集合里该关键字会被记录一个删除标记。</p>
<p>如果在模拟交易的过程中多次修改一个关键字的值，则写集合里只保留最后一次写入的值。</p>
<p>关键字的版本号只在读集合中记录，写集合中只保存关键字及其最新值，并不包含版本号版本号的最低要求是可用于标识关键字的不重复的标识符，可以通过以下两种方式实现版本号。</p>
<ul>
<li>使用自增数字作为版本号。</li>
<li>基于区块链的高度生成版本号。</li>
</ul>
<h2 id="部署Fabric生产网络">部署Fabric生产网络</h2>
<h3 id="步骤">步骤</h3>
<p>(1)根据实际情况设计生产网络的网络配置，具体包括如下内容。</p>
<ul>
<li>参与网络的组织及对应需要搭建的CA Server。</li>
<li>需要创建的通道、参与通道的组织及它们的Peer 节点</li>
<li>需要设置的排序节点及管理它们的组织。</li>
<li>需要部署的链码。</li>
</ul>
<p>(2)准备和搭建基础设施，包括租用云主机、安装Go语言环境和其他所需要的软件</p>
<p>(3)搭建网络发起者所需要的核心网络，其中包括搭建网络发起者的各个主要的Fabric 组件。</p>
<p>(4)邀请其他的参与组织加入网络，并依次安装这些组织的Fabric组件。在生产网络中部署Fabric组件的方法将在7.2节中介绍。</p>
<p>(5)创建和管理通道，并将相关组织的Peer节点加入通道。</p>
<p>(6)上传并部署链码。</p>
<p>(7)安装使用Fabric生产网络的应用程序，调试应用程序与链码的通信，并测试应用程序的主要功能。</p>
<h3 id="设计生产网络的结构和配置">设计生产网络的结构和配置</h3>
<p>生产网络的结构取决于其根据实际需求而提供的具体服务，每个组件在每个功能点上都有很多配置选项。本小节将结合具体的应用场景给出一些建议。</p>
<p>与开发环境相比，生产网络对安全性、资源管理和高可用性的要求更高一些。在设计生产网络的结构时，需要考虑诸如以下问题。</p>
<p>(1)需要部署多少个节点才能满足高可用性的要求?<br>
(2)在什么样的数据中心部署生产网络可以同时满足数据存储和数据恢复的需求?<br>
(3)如何确保私钥和信任根的安全?</p>
<p>除此之外，在部署组件之前还应该在以下几个方面做好设计。</p>
<p>(1)生产网络的基本结构:例如生产网络中需要创建几个通道，每个通道的参与组织包括哪些，每个组织都有多少个Peer 节点;排序服务由多少个排序节点组成，谁来管理和维护这些排序节点。</p>
<p>(2)CA配置:在生产网络中如何部署CA也是必须考虑的重要因素。在生产网络中应该使用TLS进行加密通信，这样就需要设置一个 TLS CA，用于生成 TLS 证书。关于搭建CA的具体方法将在7.2.2小节中介绍。</p>
<p>(3)选择数据库的类型:有些通道可能会要求所有数据模块化处理，这就需要使用CouchDB作为状态数据库。在6.1.5小节已经介绍了启用 CouchDg 作为状态数据库的方法。而对于更注重操作速度的网络，则可能会决定所有Peer节点都使用LeveIDB。需要注意的是，通道中不能既包含使用LevelDB的Peer 节点，又包含使用CouchDB的Peer 节点。因为当CouchDB强制在键值对上启用一些数据约束时，在levelDB中有效的键和值在CouchDB中不一定有效。</p>
<p>(4)使用通道还是私有数据集:有些情况适合选择通道作为确保数据隐私和交易隔离的最佳方式;而有些情况则适合尽量少地使用通道，此时私有数据集足以满足生产网络对数据隐私保护的要求。</p>
<p>(5)容器的编排方式:在大多数情况下，生产网络采用容器化部署。容器编排是指将容器的部署、管理、弹性伸缩(添加或移除节点)等都进行自动化处理。在大中型网络中容器编排可以带来极大的管理便利。区块链是分布式系统，生产网络中包含各种不同的组件。不同的用户可能会选择使用不同的容器编排方式。有的用户会为Peer进程、排序服务日志服务、CouchDB、链码等创建独立的容器，而有的用户则会选择将有些组件合并在一个容器中。因此，需要根据实际情况做好容器编排。</p>
<p>(6)链码的部署方式:可以使用内置的构建和运行方式，也可以使用自定义的构建和运行方式。自定义的构建和运行方式包括两种，一种是使用外部构建器和加载器，另一种是以外部服务使用链码。关于链码的部署将在第9章中介绍。由于篇幅有限、本书不具体介绍以外部服务使用链码的方法。</p>
<p>(7)使用防火墙:在生产网络中，属于一个组织的组件可能需要访问其他组织的组件。出于安全的考虑有必要使用防火墙，并做好相关的网络配置。例如，利用Fabric SDK访问所有组织背书节点的应用程序,以及利用Fabric SDK访问排序服务接收新区块的Peer节点,这两种访问都需要通过防火墙实现。</p>
<p>以上因素可以在设计生产网络的结构和配置时进行衡量，并做出决策。无论选择哪些组件、如何部署、都需要选择一款实用性高的管理系统，例如Kubemetes，这样才能更高效地管理和操作生产网络，以满足具体的业务需求。</p>
<p>在设计生产网络的结构时，还应该考虑符合所在国家的相关法律、法规及行业标准的要求。例如，在国内的生产网络和系统都应该按照《中华人民共和国网络安全法》定进行信息系统安全等级保护测评，以保证其满足相关级别的安全指标要求。</p>
<h3 id="在生产网络中部署Fabric区块链的各组件">在生产网络中部署Fabric区块链的各组件</h3>
<p>在生产网络中，可以按照如下步骤部署Fabric区块链的各组件。<br>
(1)创建资源集群。<br>
(2)搭建 CA。<br>
(3)使用CA创建身份和MSP。<br>
(4)部署Peer节点。<br>
(5)部署排序节点</p>
<h4 id="创建资源集群">创建资源集群</h4>
<p>通常而言，Fabric 区块链的部署方式是不确定的，可以根据实际情况随意部署Fabric区块链。例如，可以在笔记本电脑上部署和管理Peer节点，尽管不建议这么做，因为笔记本电脑不适合长时间连续工作，但是，如果暂时没有足够的服务器和台式计算机资源，也可以使用笔记本电脑来部署Peer节点(Fabric组件)。</p>
<p>尽管Fabric区块链并没有明确禁止怎样使用资源去部署组件，但是只要有可能，建议使用容器部署各种Fabric组件，并使它们互相连接。容器可以部署在本地或局域网，也可以部署在云端。容器化部署可以实现在一个物理服务器上彼此隔离地部署多个组件，从而充分发挥资源的作用。</p>
<p>可以根据实际需求选择使用Kubemetes或Docker Swarm实现容器化部署。无论怎样选择，都需要首先评估其是否拥有让组件高效运行的物理资源。可以根据实际的业务需求来设计Fabric 区块链的规模，并决定每类组件部署的实际数量，然后评估需要的物理服务器的配置和数量。可以参考以下原则设置物理资源。</p>
<ul>
<li>如果计划将一个Peer 节点加入多个高容量的通道中，则该Peer 节点的物理服务器应该具有更多的 CPU 和内存资源。</li>
<li>如果只计划将一个Peer节点加入一个通道中，则该Peer 节点的配置可以稍微低一些。</li>
<li>通常，如果只部署一个排序节点，则它分配的物理资源应该是一个Peer 节点的3倍。</li>
<li>建议排序服务至少有3个排序节点，最好有5个排序节点。</li>
<li>一个 CA Server 大概会占用 10 倍于 Peer 节点的物理资源。</li>
<li>还应该考虑给集群增加存储设备，因为在搭建集群时很难预估长期运行所需要的存储设备。增加持久化存储设备的目的是使MSP、账本和已安装链码的数据不存储在容器的文件系统中，这样可以避免在容器关闭时造成数据丢失。</li>
</ul>
<p>最开始搭建好Fabric生产网络时，建议进行压力测试，以验证生产网络的资源配置是否满足实际需求，并根据测试结果调整资源配置。很多云服务提供商都提供商业化的压力测试工具,例如阿里云的 PTS( Performance Testing Service,性能测试服务 )和腾讯的 WeTest平台，也可以选择使用LoadRunner或JMeter 等压力测试工具。</p>
<h4 id="搭建-CA">搭建 CA</h4>
<p>在Fabric生产网络中，第一个部署的组件应该是CA。因为与节点相关的证书(包括节点管理员的证书)都是由CA生成的，所以这些证书应该在部署节点之前就准备好。尽管并不是必须使用Fabric CA(也可以选择使用其他第三方CA)生成这些证书，但是Fabric CA可以创建组件和组织需要的MSP目录结构。如果选择使用FabricCA来生成证书，则Fabric CA 还需要为自己创建 MSP 文件夹。</p>
<p>根据 CA的作用可以将其分为下面两类。</p>
<p>(1)一类CA用于生成管理员所属组织的证书。此类CA也称为登录 CA。登录CA可以只有一个 CA Server，也可以是由一个根 CA 和若干个中间 CA 组成的 CA Server 集群。此种类型的CA也可以为组织创建MSP，以及为其他用户生成证书。</p>
<p>(2)另一类CA用于生成TLS安全通信所需要的证书,因此,此类CA也称为TLS CA。<br>
TLS证书可以防止在通信过程中出现中间人攻击。</p>
<p>在生产网络中，建议为每个组织至少部署一个CA，而其他的CA用于TLS通信:假定需要为一个组织A部署3个相关联的Peer节点，并且需要为另一个负责排序服务的组织B部署一个相关联的排序节点，则至少需要4个CA,其中2个CA为组织A服务，作用如下。</p>
<ul>
<li>一个CA用于生成管理员和用户证书，并生成代表相关组织的MSP目录结构。</li>
<li>另一个 CA 负责 TLS 通信。</li>
</ul>
<p>另外2个CA为组织B服务，它们的作用与上面所述作用类似。</p>
<h4 id="使用CA创建身份和MSP">使用CA创建身份和MSP</h4>
<p>搭建CA后，可以利用它们为与组织相关的身份和组件生成证书。而组织由MSP所代表。每个组织都至少应该完成如下工作。</p>
<p><strong>1.注册并登录一个管理员身份，并创建一个 MSP</strong></p>
<p>当与组织相关联的CA搭建好后，首先注册一个用户，然后登录一个身份。具体操作如下。</p>
<p>(1)由CA 的管理员指定登录身份的用户名和密码，还要设置身份的属性和附属信息(例如，指定身份的角色是admin，并根据需要设置组织管理员的必要信息)。CA会为一个身份生成下面2个证书。</p>
<ul>
<li>公钥证书:网络中所有成员都可以拥有的证书，其中包含对应身份的公钥。</li>
<li>私钥证书:保存在keystore 文件夹下，用于对该身份所采取的动作进行签名。</li>
</ul>
<p>(2)注册身份后，可以使用用户名和密码进行登录。</p>
<p>(3)CA还会创建一个名为msp的文件夹，其中包含发行身份证书的CA的公钥证书以及信任根 CA的公钥证书。</p>
<p>组织的管理员通常也是节点的管理员。必须在创建节点的本地MSP之前创建组织的管理员身份，因为在创建本地MSP时需要用到节点管理员的证书。</p>
<p><strong>2.注册并登录节点身份</strong></p>
<p>节点身份必须使用登录CA和TLS CA进行注册和登录。当使用登录CA来注册节点时,指定的角色不是admin或user,而是peer或orderer。节点的 MSP 结构也叫作本地 MSP，因为指定身份所赋予的权限只与本地节点相关。本地MSP在创建节点身份时生成，在启节点时会被用到。</p>
<h4 id="部署Peer节点">部署Peer节点</h4>
<p>准备好所有需要的证书和MSP后，就可以创建Peer节点了。</p>
<p>Peer节点是生产网络的基础元素，因为Peer节点用于存储账本和智能合约，并且用于封装生产网络中的共享进程和共享信息。在生产网络下部署Peer节点之前需要考虑如下因素。</p>
<p><strong>1.生成Peer节点的身份和MSP</strong></p>
<p>可以参照7.2.3小节的内容完成本操作。需要注意的是，cryptogen 工具只能用于测试网络，而不能在生产网络中使用。也可以不使用Fabric CA，而选择使用其他第三方CA来生成 Peer节点的身份。但是这样就需要手动创建Peer节点所需要部署的MSP目录结构，当然，可以参照测试网络中Peer节点的MSP目录结构进行创建，位置为test-network/organizations/peerOrganizations,<a target="_blank" rel="noopener" href="http://xn--orgl-zf5f27o35ch3c.example.com">其中包含orgl.example.com</a>、org2.example.co和 org3.example.com等子目录,每个子目录存储一个组织的资源文件。org1.example.com的目录结构如图 7-1所示。</p>
<p><strong>2.启用 TLS</strong></p>
<p>出于安全通信的考虑，在生产网络中应该启用TLS。因此，除了使用组织的登录CA注册Peer身份外，还需要组织的TLS CA注册Peer身份。生成的TLS证书会在与生产网络通信时用到。</p>
<p><strong>3.状态数据库</strong></p>
<p>每个Peer节点都维护一个状态数据库，状态数据库中存储着账本上所有键的最新值。Fabric 区块链支持内置的LeveIDB和外置的 CouchDB两种类型的状态数据库。如果需要支持富查询，则建议选择CouchDB;如果只进行按键查询，且对查询速度有较高要求，则建议使用默认的LeveDB。LeveDB内嵌在 Peer 进程中，因此非常便于管理。</p>
<p>一个通道中的所有Peer节点都必须使用相同的状态数据库，因此，Peer节点状态数据库的选择实际上取决于它希望加入的通道。</p>
<p><strong>4.调整 Peer 节点的资源配置</strong><br>
通常，Peer 节点会有几个与之相关联的容器，具体如下。</p>
<ul>
<li>
<p>Peer 容器:封装 Peer 进程，为其所在的通道验证并写入交易。Peer 容器的存储包含其所在通道的历史交易。如果状态数据库选择LeveIDB，则其数据也会存储在Peer容器本地。如果 Peer 节点上安装了链码，则 Peer 容器的存储还应考虑链码的大小。综上所述，Peer 容器的存储空间大小取决于其所属通道的数量、每个通道中交易的数量及Peer节点上安装的链码大小。</p>
</li>
<li>
<p>CouchDB 容器(可选):如果选择CouchDB作为状态数据库，则每个通道都会启动一个 CouchDB 容器。</p>
</li>
<li>
<p>链码加载容器(可选):用于为每个链码加载一个独立的容器。链码加载容器可以在Peer容器中启动一个Docker 容器。需要注意的是，链码加载容器并不是智能合约真正运行的容器，它只是为智能合约提供了比和Peer一起部署的容器更小一些的资源。只有在运行智能合约且需要创建容器时，链码加载容器才会存在。</p>
</li>
<li>
<p>链码容器:链码运行的容器。前面提到的链码加载容器会将每个链码部署到独立的<br>
容器中，即使一个通道中有多个Peer节点，它们都部署了相同的链码，这些链码在运行时也会被分别部署到彼此独立的容器中。</p>
</li>
</ul>
<p>在生产网络中还需要考虑网络的高可用性，即使个别Peer节点掉线也不影响网络的正常运行。要达到这个效果,就要设置一些冗余的Peer节点,并且定期检测Peer 节点的性能以便出现异常时及早发现并处理。</p>
<h4 id="部署排序节点">部署排序节点</h4>
<p>在Fabric生产网络中部署排序节点的过程如下。</p>
<p><strong>1.规划排序服务</strong></p>
<p>首先根据网络规模和交易数量来确定构成排序服务的排序节点数量。正如本章前面建议的，排序服务至少有3个排序节点，最好有5个排序节点;这些排序节点可以由一个组织维护，也可以由多个组织共同管理。</p>
<p><strong>2.配置每个排序节点的参数</strong></p>
<p>准备好在生产网络下搭建排序服务后，需要编辑排序节点Docker镜像中的配置文件orderer.yaml 中的参数。orderer.yaml位于 Docker 镜像中的/etc/hyperledger/fabric/目录下。可以参照5.3.3小节理解 orderer.yaml 中配置参数的作用。</p>
<p><strong>3.部署排序节点</strong><br>
可以参照如下步骤部署排序节点。</p>
<p>(1)准备好排序服务需要的二进制文件和配置文件，具体如下。</p>
<ul>
<li>建议将二进制文件存放在 fabric/bin 目录下。从下载的 Fabric 源代码中的 fabric/cmd目录下复制二进制文件到 fabric/bin 目录下。</li>
<li>建议将配置文件存放在fabric/config目录下。从下载的Fabric 源代码中的fabric/scripts/config 日录下复制配置文件到 fabric/config 目录下。</li>
<li>将fabric/bin添加到环境变量ATH</li>
</ul>
<p>(2)使用Fabric CA或第三方CA为排序节点生成证书，具体如下。</p>
<ul>
<li>排序组织的 MSP。</li>
<li>排序节点的TLS CA证书:</li>
<li>排序节点的本地 MSP。</li>
</ul>
<p>(3)创建系统通道的创世区块。</p>
<p>(4)配置orderer.yaml。</p>
<p>(5)启动排序节点。</p>
<h1>实验记录</h1>
<h2 id="CentOS7-9-GLIBC-2-28-not-found">CentOS7.9 GLIBC_2.28 not found</h2>
<h3 id="安装C-compliler">安装C compliler</h3>
<p><code>yum install gcc -y</code></p>
<h3 id="升级GCC编译器">升级GCC编译器</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">yum -y install centos-release-scl</span><br><span class="line">yum -y install devtoolset-8-gcc devtoolset-8-gcc-c++ devtoolset-8-binutils</span><br><span class="line">scl enable devtoolset-8 bash</span><br><span class="line">echo &quot;source /opt/rh/devtoolset-8/enable&quot; &gt;&gt;/etc/profile</span><br></pre></td></tr></table></figure>
<h3 id="升级make">升级make</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">wget http://ftp.gnu.org/gnu/make/make-4.2.tar.gz</span><br><span class="line">tar -xzvf make-4.2.tar.gz</span><br><span class="line">cd make-4.2</span><br><span class="line">sudo ./configure</span><br><span class="line">sudo make</span><br><span class="line">sudo make install</span><br><span class="line">sudo rm -rf /usr/bin/make</span><br><span class="line">sudo cp ./make /usr/bin/</span><br><span class="line">make -v</span><br></pre></td></tr></table></figure>
<h3 id="升级glic-2-28">升级glic-2.28</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">wget  https://mirror.bjtu.edu.cn/gnu/libc/glibc-2.28.tar.xz</span><br><span class="line">tar -xf glibc-2.28.tar.xz -C /usr/local</span><br><span class="line">cd /usr/local/glibc-2.28/</span><br><span class="line">mkdir build</span><br><span class="line">cd build/</span><br><span class="line">yum install -y bison</span><br><span class="line">sudo ../configure --prefix=/usr --disable-profile --enable-add-ons --with-headers=/usr/include --with-binutils=/usr/bin</span><br><span class="line">make  </span><br><span class="line">make install</span><br><span class="line">strings /lib64/libc.so.6 | grep GLIBC</span><br><span class="line">make localedata/install-locales</span><br></pre></td></tr></table></figure>
<blockquote>
<p>来源：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/FengZeng666/p/15989106.html">https://www.cnblogs.com/FengZeng666/p/15989106.html</a></p>
</blockquote>
<h2 id="mysql无法开启">mysql无法开启</h2>
<h3 id="systemctl-status-mysqld">systemctl status mysqld</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@local mysql]# systemctl status mysqld</span><br><span class="line">● mysqld.service - MySQL Server</span><br><span class="line">   Loaded: loaded (/usr/lib/systemd/system/mysqld.service; enabled; vendor preset: disabled)</span><br><span class="line">   Active: failed (Result: exit-code) since Fri 2024-06-21 09:16:31 EDT; 1min 50s ago</span><br><span class="line">     Docs: man:mysqld(8)</span><br><span class="line">           http://dev.mysql.com/doc/refman/en/using-systemd.html</span><br><span class="line">  Process: 9181 ExecStart=/usr/sbin/mysqld $MYSQLD_OPTS (code=exited, status=1/FAILURE)</span><br><span class="line">  Process: 9152 ExecStartPre=/usr/bin/mysqld_pre_systemd (code=exited, status=0/SUCCESS)</span><br><span class="line"> Main PID: 9181 (code=exited, status=1/FAILURE)</span><br><span class="line">   Status: &quot;Server shutdown complete (with return value = 1)&quot;</span><br><span class="line"></span><br><span class="line">Jun 21 09:16:29  systemd[1]: Starting MySQL Server...</span><br><span class="line">Jun 21 09:16:31  systemd[1]: mysqld.service: main process exited, code=exited, status=1/FAILURE</span><br><span class="line">Jun 21 09:16:31  systemd[1]: Failed to start MySQL Server.</span><br><span class="line">Jun 21 09:16:31  systemd[1]: Unit mysqld.service entered failed state.</span><br><span class="line">Jun 21 09:16:31  systemd[1]: mysqld.service failed.</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="cat-var-log-mysqld-log">cat /var/log/mysqld.log</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">2024-06-21T12:50:11.343450Z 0 [System] [MY-015015] [Server] MySQL Server - start.</span><br><span class="line">2024-06-21T12:50:12.618088Z 0 [System] [MY-010116] [Server] /usr/sbin/mysqld (mysqld 8.4.0) starting as process 3109</span><br><span class="line">2024-06-21T12:50:13.618033Z 1 [System] [MY-013576] [InnoDB] InnoDB initialization has started.</span><br><span class="line">2024-06-21T12:50:15.650779Z 1 [ERROR] [MY-012592] [InnoDB] Operating system error number 2 in a file operation.</span><br><span class="line">2024-06-21T12:50:15.650820Z 1 [ERROR] [MY-012593] [InnoDB] The error means the system cannot find the path specified.</span><br><span class="line">2024-06-21T12:50:15.650855Z 1 [ERROR] [MY-012216] [InnoDB] Cannot open datafile for read-only: &#x27;mysql.ibd&#x27; OS error: 71</span><br><span class="line">mysqld: Can&#x27;t open file: &#x27;mysql.ibd&#x27; (errno: 0 - )</span><br><span class="line">2024-06-21T12:50:16.146304Z 1 [ERROR] [MY-010334] [Server] Failed to initialize DD Storage Engine</span><br><span class="line">2024-06-21T12:50:16.146567Z 0 [ERROR] [MY-010020] [Server] Data Dictionary initialization failed.</span><br><span class="line">2024-06-21T12:50:16.146647Z 0 [ERROR] [MY-010119] [Server] Aborting</span><br><span class="line">2024-06-21T12:50:16.148910Z 0 [System] [MY-010910] [Server] /usr/sbin/mysqld: Shutdown complete (mysqld 8.4.0)  MySQL Community Server - GPL.</span><br><span class="line">2024-06-21T12:50:16.148947Z 0 [System] [MY-015016] [Server] MySQL Server - end.</span><br><span class="line">2024-06-21T12:54:26.723826Z 0 [System] [MY-015015] [Server] MySQL Server - start.</span><br><span class="line">2024-06-21T12:54:26.943934Z 0 [System] [MY-010116] [Server] /usr/sbin/mysqld (mysqld 8.4.0) starting as process 8150</span><br><span class="line">2024-06-21T12:54:26.951838Z 1 [System] [MY-013576] [InnoDB] InnoDB initialization has started.</span><br><span class="line">2024-06-21T12:54:28.417079Z 1 [ERROR] [MY-012592] [InnoDB] Operating system error number 2 in a file operation.</span><br><span class="line">2024-06-21T12:54:28.417122Z 1 [ERROR] [MY-012593] [InnoDB] The error means the system cannot find the path specified.</span><br><span class="line">2024-06-21T12:54:28.417154Z 1 [ERROR] [MY-012216] [InnoDB] Cannot open datafile for read-only: &#x27;mysql.ibd&#x27; OS error: 71</span><br><span class="line">mysqld: Can&#x27;t open file: &#x27;mysql.ibd&#x27; (errno: 0 - )</span><br><span class="line">2024-06-21T12:54:28.484964Z 1 [ERROR] [MY-010334] [Server] Failed to initialize DD Storage Engine</span><br><span class="line">2024-06-21T12:54:28.485235Z 0 [ERROR] [MY-010020] [Server] Data Dictionary initialization failed.</span><br><span class="line">2024-06-21T12:54:28.485273Z 0 [ERROR] [MY-010119] [Server] Aborting</span><br><span class="line">2024-06-21T12:54:28.487463Z 0 [System] [MY-010910] [Server] /usr/sbin/mysqld: Shutdown complete (mysqld 8.4.0)  MySQL Community Server - GPL.</span><br><span class="line">2024-06-21T12:54:28.487499Z 0 [System] [MY-015016] [Server] MySQL Server - end.</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="解决方案">解决方案</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">systemctl stop mysqld</span><br><span class="line">rm -rf /var/lib/mysql/*</span><br><span class="line">systemctl start mysqld</span><br></pre></td></tr></table></figure>
<h2 id="x509：ECDSA-verification-failure报错">x509：ECDSA verification failure报错</h2>
<h3 id="报错信息">报错信息</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Failed validating bootstrap block: initializing channelconfig failed: could not create channel Orderer sub-group config: setting up the MSP manager failed: the supplied identity is not valid: x509: certificate signed by unknown authority (possibly because of &quot;x509: ECDSA verification failure&quot; while trying to verify candidate authority certificate</span><br></pre></td></tr></table></figure>
<h3 id="原因">原因</h3>
<p>将服务都停了后，又重复执行了证书生成脚本和创世区块生成命令导致。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cd /data/blockchain/hyperledger/fabric_cluster</span><br><span class="line">cryptogen generate --config=./config/crypto-config.yaml</span><br><span class="line">cd /data/blockchain/hyperledger/fabric_cluster</span><br><span class="line">configtxgen -profile SampleMultiNodeEtcdRaft -channelID mychannel -configPath ./config -outputBlock ./channel-artifacts/genesis.block</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>生产环境请不要多次执行上面两命令。</p>
<p><strong>测试环境解决办法： 删除证书和创世区块文件，重新生成，再启动。</strong></p>
<blockquote>
<p>来源：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/zoujiaojiao/p/13361475.html">https://www.cnblogs.com/zoujiaojiao/p/13361475.html</a></p>
</blockquote>
<h2 id="failed-0-sub-policies-were-satisfied-but-this-policy-requires-1-of-the-‘Writers’-sub-policies-to-be-satisfied-permission-denied">failed - 0 sub-policies were satisfied, but this policy requires 1 of the ‘Writers’ sub-policies to be satisfied: permission denied</h2>
<h3 id="原因-2">原因</h3>
<p>生成通道创世区块的<code>channelID</code>要与生成创建通道使用的配置交易文件的<code>channelID</code>要不一样，猜测是<strong>测试网络生成通道后，生产网络网络中不能生成相同的通道，需要修改通道名字。</strong></p>
<h3 id="报错信息-2">报错信息</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Error: got unexpected status: FORBIDDEN -- config update for existing channel did not pass initial checks: implicit policy evaluation failed - 0 sub-policies were satisfied, but this policy requires 1 of the &#x27;Writers&#x27; sub-policies to be satisfied: permission denied</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="解决方案1">解决方案1</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">测试网络命令</span><br><span class="line"></span><br><span class="line">#生成系统通道syschannel的创世区块：</span><br><span class="line"></span><br><span class="line">cd /data/blockchain/hyperledger/fabric_cluster</span><br><span class="line">configtxgen -profile SampleMultiNodeEtcdRaft -channelID syschannel -configPath ./config -outputBlock ./channel-artifacts/genesis.block</span><br><span class="line"></span><br><span class="line">#生成创建应用通道使用的配置交易文件</span><br><span class="line">configtxgen -profile TwoOrgsChannel -configPath ./config -outputCreateChannelTx ./channel-artifacts/channel.tx -channelID mychannel</span><br><span class="line"></span><br><span class="line">生产网络命令</span><br><span class="line"></span><br><span class="line">#进入容器cli-peer0-org1的内部。</span><br><span class="line"></span><br><span class="line">docker exec -it cli-peer0-org1 bash </span><br><span class="line"></span><br><span class="line"># 在容器中创建通道mychannel。（其实此命令可不用）</span><br><span class="line"></span><br><span class="line">peer channel create -o orderer0.consortiums.com:7050 -c mychannel -f /hyperledger/opt/peer/channel-artifacts/channel.tx --tls --cafile /hyperledger/opt/peer/crypto-config/ordererOrganizations/consortiums.com/orderers/orderer0.consortiums.com/msp/tlscacerts/tlsca.consortiums.com-cert.pem </span><br><span class="line"></span><br><span class="line">#将当前Peer节点加入通道中。</span><br><span class="line">peer channel join -b /hyperledger/opt/peer/channel-artifacts/genesis.block</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#更新锚节点</span><br><span class="line"></span><br><span class="line">#进入容器cli-peer0-org1的内部。</span><br><span class="line">docker exec -it cli-peer0-org1 bash </span><br><span class="line"></span><br><span class="line">#更新组织org1的锚节点，命令如下。</span><br><span class="line">peer channel update -o orderer0.consortiums.com:7050 -c mychannel -f /hyperledger/opt/peer/channel-artifacts/Org1MSPanchors.tx --tls --cafile /hyperledger/opt/peer/crypto-config/ordererOrganizations/consortiums.com/orderers/orderer0.consortiums.com/msp/tlscacerts/tlsca.consortiums.com-cert.pem</span><br></pre></td></tr></table></figure>
<h3 id="解决方案2">解决方案2</h3>
<p>创世区块通道名字不改，进入<code>cli-peer0-org1</code>容器之后，不需要创建通道<code>mychannel</code>，直接将Peer节点加入通道和更新组织的锚节点。</p>
<h1>章节资料</h1>
<h2 id="03">03</h2>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br></pre></td><td class="code"><pre><span class="line">ip addr</span><br><span class="line">cd /etc/sysconfig/network-scripts</span><br><span class="line">vi ifcfg-enp0s3</span><br><span class="line"></span><br><span class="line">#重新启动网络</span><br><span class="line">service network restart</span><br><span class="line"></span><br><span class="line">#ping通百度</span><br><span class="line">ping www.baidu.com</span><br><span class="line"></span><br><span class="line">#ifcfg-enp0s8的内容如下：</span><br><span class="line"></span><br><span class="line">TYPE=Ethernet</span><br><span class="line">PROXY_METHOD=none</span><br><span class="line">BROWSER_ONLY=no</span><br><span class="line">BOOTPROTO=static</span><br><span class="line">IPADDR=192.168.56.101</span><br><span class="line">NETMASK=255.255.255.0</span><br><span class="line">DNS1=202.106.0.20</span><br><span class="line">DNS2=8.8.8.8</span><br><span class="line">GATEWAY=192.168.56.1</span><br><span class="line">DEFROUTE=yes</span><br><span class="line">IPV4_FAILURE_FATAL=no</span><br><span class="line">IPV6INIT=yes</span><br><span class="line">IPV6_AUTOCONF=yes</span><br><span class="line">IPV6_DEFROUTE=yes</span><br><span class="line">IPV6_FAILURE_FATAL=no</span><br><span class="line">IPV6_ADDR_GEN_MODE=stable-privacy</span><br><span class="line">NAME=enp0s8</span><br><span class="line">UUID=b86ee2d0-57a8-4e49-8eaf-803edd59d4df</span><br><span class="line">DEVICE=enp0s8</span><br><span class="line">ONBOOT=yes</span><br><span class="line"></span><br><span class="line">#2．在CentOS中安装Docker</span><br><span class="line">#（1）升级yum包：</span><br><span class="line">sudo yum update</span><br><span class="line">#（2）卸载旧版本</span><br><span class="line">sudo yum remove docker  docker-common docker-selinux docker-engine</span><br><span class="line">#（3）安装需要的软件包</span><br><span class="line">sudo yum install -y yum-utils device-mapper-persistent-data lvm2</span><br><span class="line">#（4）选择安装Docker的版本，执行如下命令设置yum源。</span><br><span class="line">sudo yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span><br><span class="line"></span><br><span class="line">#查看所有仓库中所有docker版本。</span><br><span class="line">yum list docker-ce --showduplicates | sort -r</span><br><span class="line">#查看Docker的版本。</span><br><span class="line">docker --version</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#3．Docker服务管理</span><br><span class="line">#启动Docker服务。</span><br><span class="line">systemctl start docker</span><br><span class="line"></span><br><span class="line">#查看Docker服务的状态。</span><br><span class="line">systemctl status docker</span><br><span class="line"></span><br><span class="line">#设置自动启动Docker服务。</span><br><span class="line">systemctl enable docker</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#4．配置Docker镜像加速器</span><br><span class="line"></span><br><span class="line">sudo mkdir -p /etc/docker </span><br><span class="line">vi /etc/docker/daemon.json </span><br><span class="line"></span><br><span class="line">#应用配置，重启Docker服务。</span><br><span class="line">sudo systemctl daemon-reload</span><br><span class="line">sudo systemctl restart docker</span><br><span class="line"></span><br><span class="line">5．使用Docker容器</span><br><span class="line">#使用docker run命令可以运行Docker镜像</span><br><span class="line">docker run hello-world</span><br><span class="line"></span><br><span class="line">#查看本机Docker镜像</span><br><span class="line">docker images</span><br><span class="line"></span><br><span class="line">#拉取ubuntu</span><br><span class="line">docker pull ubuntu</span><br><span class="line"></span><br><span class="line">#运行镜像</span><br><span class="line">docker run -it ubuntu /bin/bash</span><br><span class="line"></span><br><span class="line">#查看Docker容器信息</span><br><span class="line">docker ps -a</span><br><span class="line"></span><br><span class="line">#启动Docker容器</span><br><span class="line">docker start  Docker容器ID</span><br><span class="line"></span><br><span class="line">#停止Docker容器</span><br><span class="line">docker stop  Docker容器ID</span><br><span class="line"></span><br><span class="line">#删除Docker容器</span><br><span class="line">Docker rm &lt;Docker容器ID&gt;</span><br><span class="line"></span><br><span class="line">#删除Docker镜像</span><br><span class="line">Docker rmi &lt;Docker镜像ID&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#2．在CentOS中安装Docker</span><br><span class="line">#安装wget</span><br><span class="line">yum install -y wget</span><br><span class="line"></span><br><span class="line">#（1）下载Go 1.15.3的安装包：</span><br><span class="line">cd /usr/local/</span><br><span class="line">wget https://studygolang.com/dl/golang/go1.15.3.linux-amd64.tar.gz</span><br><span class="line"></span><br><span class="line">#（2）解压缩GO语言源码到$HOME目录：</span><br><span class="line">tar -C $HOME -xzf  go1.15.3.linux-amd64.tar.gz</span><br><span class="line"></span><br><span class="line">#（3）创建保存Go语言程序的目录$HOME/gocode：</span><br><span class="line">mkdir $HOME/gocode</span><br><span class="line"></span><br><span class="line">#（4）执行下面的命令，设置GO语言的环境变量。</span><br><span class="line">vi ~/.bashrc</span><br><span class="line"></span><br><span class="line">#然后在文件中添加如下代码：</span><br><span class="line">export GOPATH=$HOME/gocode</span><br><span class="line">export GOROOT=$HOME/go</span><br><span class="line">export PATH=$PATH:$GOROOT/bin</span><br><span class="line">export PATH=$PATH:$GOPATH/bin</span><br><span class="line"></span><br><span class="line">#编译.bashrc文件</span><br><span class="line">source ~/.bashrc</span><br><span class="line"></span><br><span class="line">#查看GO语言的版本</span><br><span class="line"></span><br><span class="line">go version</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#卸载较低版本的Git</span><br><span class="line">yum remove -y git</span><br><span class="line"></span><br><span class="line">#安装git的命令如下：</span><br><span class="line">yum -y install git</span><br><span class="line"></span><br><span class="line">#查看git的版本信息。</span><br><span class="line">git version</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#安装curl：</span><br><span class="line"></span><br><span class="line">yum install -y curl</span><br><span class="line"></span><br><span class="line">#从GitHub下载与CentOS版本相匹配的Docker Compose</span><br><span class="line"></span><br><span class="line">sudo curl -L https://get.daocloud.io/docker/compose/releases/download/1.29.2/docker-compose-`uname -s`-`uname -m` &gt; /usr/local/bin/docker-compose</span><br><span class="line"></span><br><span class="line">#为安装脚本添加执行权限。</span><br><span class="line"></span><br><span class="line">sudo chmod +x /usr/local/bin/docker-compose</span><br><span class="line"></span><br><span class="line">#查看Docker Compose的版本信息。</span><br><span class="line"></span><br><span class="line">docker-compose -v</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#创建一个保存Hyperledger源代码的目录</span><br><span class="line"></span><br><span class="line">mkdir $GOPATH/src</span><br><span class="line">mkdir $GOPATH/src/github.com</span><br><span class="line">mkdir $GOPATH/src/github.com/hyperledger</span><br><span class="line"></span><br><span class="line">#1．下载Fabric源代码</span><br><span class="line">cd $GOPATH/src/github.com/hyperledger</span><br><span class="line">git clone https://gitee.com/mirrors/fabric.git</span><br><span class="line"></span><br><span class="line">#下载Fabric区块链的示例代码</span><br><span class="line"></span><br><span class="line">cd $GOPATH/src/github.com/hyperledger/fabric/scripts/</span><br><span class="line">git checkout release-2.3</span><br><span class="line">git clone https://gitee.com/hyperledger/fabric-samples.git</span><br><span class="line"></span><br><span class="line">#3．安装Fabric区块链</span><br><span class="line">cd $GOPATH/src/github.com/hyperledger/fabric/scripts/</span><br><span class="line">sh bootstrap.sh</span><br><span class="line"></span><br><span class="line">#在执行 bootstrap.sh脚本的时候，通过参数-b控制跳过调用download()函数下载 这两个文件</span><br><span class="line"></span><br><span class="line">cd $GOPATH/src/github.com/hyperledger/fabric/scripts/</span><br><span class="line">./bootstrap.sh -b</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#编辑/etc/profile，在文档最后，添加如下代码：</span><br><span class="line"></span><br><span class="line">export PATH=&quot;/$GOPATH/src/github.com/hyperledger/fabric/scripts/fabric-samples/bin:$PATH&quot;</span><br><span class="line"></span><br><span class="line">#使环境变量生效。</span><br><span class="line"></span><br><span class="line">source /etc/profile</span><br><span class="line"></span><br><span class="line">#执行如下命令：</span><br><span class="line"></span><br><span class="line">configtxgen  --help</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#启动测试网络。</span><br><span class="line"></span><br><span class="line">cd $GOPATH/src/github.com/hyperledger/fabric/scripts/fabric-samples/test-network</span><br><span class="line">./network.sh up</span><br><span class="line"></span><br><span class="line">#关闭测试网络。</span><br><span class="line"></span><br><span class="line">cd $GOPATH/src/github.com/hyperledger/fabric/scripts/fabric-samples/test-network</span><br><span class="line">./network.sh down</span><br><span class="line"></span><br><span class="line">#在启动测试网络的同时启用内置的CA服务</span><br><span class="line">./network.sh up -ca</span><br><span class="line"></span><br><span class="line">#检查Org1管理员用户的MSP文件夹</span><br><span class="line">tree organizations/peerOrganizations/org1.example.com/users/Admin@org1.example.com/</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">cd $GOPATH/src/github.com/hyperledger/fabric/scripts/fabric-samples/test-network</span><br><span class="line">./network.sh createChannel</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#daemon.json</span><br><span class="line">&#123;</span><br><span class="line"> &quot;registry-mirrors&quot;: [&quot;https://docker.mirrors.ustc.edu.cn/&quot;] </span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>
<h2 id="04">04</h2>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br></pre></td><td class="code"><pre><span class="line">#安装libtool、libtdhl-dev程序包和gcc编译器。</span><br><span class="line"></span><br><span class="line">yum install libtool-ltdl-devel</span><br><span class="line">yum -y install gcc-c++</span><br><span class="line"></span><br><span class="line">#编辑~/.bashrc，在最后添加如下代码：</span><br><span class="line"></span><br><span class="line">export PATH=$PATH:/root/go/bin/fabric-ca/bin/</span><br><span class="line"></span><br><span class="line">#然后执行下面的命令编译.bashrc文件。</span><br><span class="line"></span><br><span class="line">source ~/.bashrc</span><br><span class="line"></span><br><span class="line">#初始化Fabric CA Server。</span><br><span class="line"></span><br><span class="line">fabric-ca-server init -b admin:adminpw</span><br><span class="line"></span><br><span class="line">#启动Fabric CA Server。</span><br><span class="line"></span><br><span class="line">fabric-ca-server start -b admin:adminpw</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#【例4-1】设置环境变量FABRIC_CA_SERVER_PORT为7055。</span><br><span class="line"></span><br><span class="line">export FABRIC_CA_SERVER_PORT=7055</span><br><span class="line"></span><br><span class="line">#启动Fabric CA服务器端。</span><br><span class="line"></span><br><span class="line">fabric-ca-server start -b admin:adminpw</span><br><span class="line"></span><br><span class="line">#【例4-2】</span><br><span class="line">fabric-ca-server start -b admin:adminpw -p 7056</span><br><span class="line"></span><br><span class="line">#安装MySQL数据库：</span><br><span class="line"></span><br><span class="line">yum install mysql-community-server -y</span><br><span class="line"></span><br><span class="line">#从日志中查看MySQL数据库的临时密码。</span><br><span class="line"></span><br><span class="line">grep &quot;temporary password&quot; /var/log/mysqld.log</span><br><span class="line"></span><br><span class="line">#对MySQL数据库进行安全设置。</span><br><span class="line"></span><br><span class="line">mysql_secure_installation</span><br><span class="line"></span><br><span class="line">#登录到MySQL数据库。</span><br><span class="line"></span><br><span class="line">mysql -u root -h localhost -p</span><br><span class="line"></span><br><span class="line">#开通任何IP地址都可以远程连接到MySQL数据库。</span><br><span class="line"></span><br><span class="line">use mysql;</span><br><span class="line">update user set host=&#x27;%&#x27; where user=&#x27;root&#x27; and host=&#x27;localhost&#x27;;</span><br><span class="line">flush privileges;</span><br><span class="line"></span><br><span class="line">#关闭防火墙。</span><br><span class="line"></span><br><span class="line">systemctl stop firewalld</span><br><span class="line"></span><br><span class="line">#查看MySQL数据库的端口工作情况。</span><br><span class="line">netstat -an|grep 3306</span><br><span class="line"></span><br><span class="line">#取消MySQL数据库的strict模式</span><br><span class="line">SET GLOBAL sql_mode = &#x27;NO_ENGINE_SUBSTITUTION&#x27;</span><br><span class="line"></span><br><span class="line">#重新初始化Fabric CA Server。</span><br><span class="line"></span><br><span class="line">fabric-ca-server init -b admin:adminpw</span><br><span class="line"></span><br><span class="line">#例4-4</span><br><span class="line">mkdir /root/go/bin/fabric-ca/clients</span><br><span class="line">mkdir /root/go/bin/fabric-ca/clients/admin</span><br><span class="line">   export FABRIC_CA_CLIENT_HOME=/root/go/bin/fabric-ca/clients/admin</span><br><span class="line"></span><br><span class="line">#在Navicat中连接MySQL数据库，执行如下命令：</span><br><span class="line"></span><br><span class="line">SET GLOBAL sql_mode = &#x27;NO_ENGINE_SUBSTITUTION&#x27;</span><br><span class="line"></span><br><span class="line">#打开一个新的终端窗口，执行如下命令启动Fabric CA Server。</span><br><span class="line"></span><br><span class="line">   fabric-ca-server start -b admin:adminpw</span><br><span class="line"></span><br><span class="line">#在原有终端窗口中执行如下命令在Fabric CA客户端登录一个已有的身份admin。</span><br><span class="line"></span><br><span class="line">fabric-ca-client enroll -u http://admin:adminpw@localhost:7054</span><br><span class="line"></span><br><span class="line">#例4-5</span><br><span class="line">fabric-ca-client register --id.name peer1-org1  --id.type peer --id.secret userpwd -u http://localhost:7054</span><br><span class="line"></span><br><span class="line">#在Fabric CA客户端使用新用户peer1-org1登录。</span><br><span class="line"></span><br><span class="line">export FABRIC_CA_CLIENT_HOME=$HOME/fabric-ca/clients/peer1-org1</span><br><span class="line">fabric-ca-client enroll -u http://peer1-org1:userpwd@localhost:7054</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#以orderer用户的身份登录到CA服务器ca-orderer，指定用户的MSP目录为$&#123;PWD&#125;/organizations/ordererOrganizations/example.com/orderers/orderer.example.com/ msp。</span><br><span class="line"></span><br><span class="line">fabric-ca-client enroll -u https://orderer:ordererpw@localhost:9054 --caname ca-orderer -M &quot;$&#123;PWD&#125;/organizations/ordererOrganizations/example.com/orderers/ orderer.example.com/msp&quot; </span><br><span class="line"></span><br><span class="line">#启动测试网络.</span><br><span class="line">cd /$GOPATH/src/github.com/hyperledger/fabric/scripts/fabric-samples/test-network</span><br><span class="line">./network.sh up -ca</span><br><span class="line"></span><br><span class="line">#查看排序服务的MSP目录结构。 </span><br><span class="line"></span><br><span class="line">cd /$GOPATH/src/github.com/hyperledger/fabric/scripts/fabric-samples/test-network/organizations/ordererOrganizations/example.com/msp</span><br><span class="line">tree</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#将cryptogen等工具文件复制到/root/orgs/文件夹下。</span><br><span class="line"></span><br><span class="line">cd /root/orgs</span><br><span class="line">cp -r $GOPATH/src/github.com/hyperledger/fabric/scripts/fabric-samples/bin/ ./</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#生成默认的crypto-config.yaml文件。</span><br><span class="line"></span><br><span class="line">cryptogen showtemplate &gt;&gt; crypto-config.yaml</span><br><span class="line"></span><br><span class="line">#生成证书。</span><br><span class="line"></span><br><span class="line">cd /root/orgs</span><br><span class="line">./bin/cryptogen generate --config=./crypto-config.yaml</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">#crypto-config.yaml</span><br><span class="line">OrdererOrgs:</span><br><span class="line">  - Name: Orderer</span><br><span class="line">    Domain: example.com</span><br><span class="line">    Specs:</span><br><span class="line">      - Hostname: orderer</span><br><span class="line"></span><br><span class="line">PeerOrgs:</span><br><span class="line">  - Name: Org1</span><br><span class="line">    Domain: org1.example.com</span><br><span class="line">    EnableNodeOUs: false</span><br><span class="line">    Template:</span><br><span class="line">      Count: 2</span><br><span class="line">    Users:</span><br><span class="line">      Count: 3</span><br><span class="line">  - Name: Org2</span><br><span class="line">    Domain: org2.example.com</span><br><span class="line">    EnableNodeOUs: false</span><br><span class="line">    Template:</span><br><span class="line">      Count: 2</span><br><span class="line">    Users:</span><br><span class="line">      Count: 2</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="05">05</h2>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">#查看系统通道的创世区块</span><br><span class="line">ll /opt/app/go/fabric/scripts/fabric-samples/test-network/system-genesis-block</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#查看configtxgen工具的使用方法</span><br><span class="line">cd $GOPATH/src/github.com/hyperledger/fabric/scripts/fabric-samples/bin/</span><br><span class="line">./configtxgen --help</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#【例5-2】  演示在测试网络中添加组织Org3</span><br><span class="line">#启动测试网络并创建通道channel1。</span><br><span class="line"></span><br><span class="line">cd $GOPATH/src/github.com/hyperledger/fabric/scripts/fabric-samples/test-network</span><br><span class="line">./network.sh up </span><br><span class="line">./network.sh createChannel -c channel1</span><br><span class="line"></span><br><span class="line">#向通道channel1中添加组织Org3</span><br><span class="line"></span><br><span class="line">cd addOrg3</span><br><span class="line">./addOrg3.sh up -c channel1</span><br></pre></td></tr></table></figure>
<h2 id="06">06</h2>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#启动测试网络后</span><br><span class="line">network.sh up -s couchdb</span><br><span class="line"></span><br><span class="line">#查看5984端口的状态。</span><br><span class="line">netstat -ntlp |grep 5984</span><br><span class="line"></span><br><span class="line">#访问如下URL可以打开CouchDB的管理页面</span><br><span class="line">http://127.0.0.1:5984/_utils</span><br></pre></td></tr></table></figure>
<h2 id="07">07</h2>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">#禁用防火墙</span><br><span class="line">systemctl stop firewalld</span><br><span class="line">systemctl disable firewalld</span><br><span class="line"></span><br><span class="line">#将cryptogen所在的路径添加到环境变量PATH中。</span><br><span class="line"></span><br><span class="line">export PATH=$GOPATH/src/github.com/hyperledger/fabric/scripts/fabric-samples/bin:$PATH</span><br><span class="line"></span><br><span class="line">#生成证书和密钥文件。</span><br><span class="line"></span><br><span class="line">cd /root/fabric_cluster</span><br><span class="line">cryptogen generate --config=./config/crypto-config.yaml</span><br><span class="line"></span><br><span class="line">#生成通道mychannel的创世区块：</span><br><span class="line"></span><br><span class="line">cd /root/fabric_cluster</span><br><span class="line">configtxgen -profile SampleMultiNodeEtcdRaft -channelID mychannel -configPath ./config -outputBlock /root/fabric_cluster/channel-artifacts/genesis.block</span><br><span class="line"></span><br><span class="line">#查看创建的创世区块。</span><br><span class="line">ls /root/fabric_cluster/channel-artifacts</span><br><span class="line"></span><br><span class="line">#4．生成创建通道使用的配置交易文件</span><br><span class="line">configtxgen -profile TwoOrgsChannel -configPath ./config -outputCreateChannelTx /root/fabric_cluster/channel-artifacts/channel.tx -channelID mychannel</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#为组织Org1配置锚节点：</span><br><span class="line"></span><br><span class="line">configtxgen -profile TwoOrgsChannel  -configPath ./config -outputAnchorPeersUpdate /root/fabric_cluster/channel-artifacts/Org1MSPanchors.tx -channelID mychannel -asOrg Org1MSP</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#为组织Org2配置锚节点：</span><br><span class="line"></span><br><span class="line">configtxgen -profile TwoOrgsChannel -configPath ./config -outputAnchorPeersUpdate /root/fabric_cluster/channel-artifacts/Org2MSPanchors.tx -channelID mychannel -asOrg Org2MSP</span><br><span class="line"></span><br><span class="line">#使用配置文件docker-compose-up.yaml启动Docker容器。</span><br><span class="line"></span><br><span class="line">docker-compose -f /root/fabric_cluster/docker-compose/docker-compose-up.yaml up -d</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#进入容器cli-peer0-org1的内部。</span><br><span class="line"></span><br><span class="line">docker exec -it cli-peer0-org1 bash </span><br><span class="line"></span><br><span class="line">#在容器中创建通道mychannel。</span><br><span class="line"></span><br><span class="line">peer channel create -o orderer0.consortiums.com:7050 -c mychannel -f /hyperledger/opt/peer/channel-artifacts/channel.tx --tls --cafile /hyperledger/opt/peer/crypto-config/ordererOrganizations/consortiums.com/orderers/orderer0.consortiums.com/msp/tlscacerts/tlsca.consortiums.com-cert.pem </span><br><span class="line"></span><br><span class="line">#将当前Peer节点加入通道中。</span><br><span class="line">peer channel join -b /hyperledger/opt/peer/channel-artifacts/genesis.block</span><br><span class="line"></span><br><span class="line">#3．更新锚节点</span><br><span class="line">#（1）进入容器cli-peer0-org1的内部。</span><br><span class="line"></span><br><span class="line">docker exec -it cli-peer0-org1 bash </span><br><span class="line"></span><br><span class="line">#（2）更新组织org1的锚节点，命令如下。</span><br><span class="line"></span><br><span class="line">peer channel update -o orderer0.consortiums.com:7050 -c mychannel -f /hyperledger/opt/peer/channel-artifacts/Org1MSPanchors.tx --tls --cafile /hyperledger/opt/peer/crypto-config/ordererOrganizations/consortiums.com/orderers/orderer0.consortiums.com/msp/tlscacerts/tlsca.consortiums.com-cert.pem</span><br><span class="line"></span><br><span class="line">#（1）进入容器cli-peer0-org2的内部。</span><br><span class="line"></span><br><span class="line">docker exec -it cli-peer0-org2 bash </span><br><span class="line"></span><br><span class="line">#（2）更新组织org2的锚节点，命令如下。</span><br><span class="line"></span><br><span class="line">peer channel update -o orderer0.consortiums.com:7050 -c mychannel -f /hyperledger/opt/peer/channel-artifacts/Org2MSPanchors.tx --tls --cafile /hyperledger/opt/peer/crypto-config/ordererOrganizations/consortiums.com/orderers/orderer0.consortiums.com/msp/tlscacerts/tlsca.consortiums.com-cert.pem</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">#hosts</span><br><span class="line"></span><br><span class="line">127.0.0.1 orderer0.consortiums.com </span><br><span class="line">127.0.0.1 orderer1.consortiums.com </span><br><span class="line">127.0.0.1 orderer2.consortiums.com </span><br><span class="line">127.0.0.1 orderer3.consortiums.com </span><br><span class="line">127.0.0.1 orderer4.consortiums.com</span><br><span class="line">127.0.0.1 peer0.org1.com </span><br><span class="line">127.0.0.1 peer1.org1.com </span><br><span class="line">127.0.0.1 peer0.org2.com </span><br><span class="line">127.0.0.1 peer1.org2.com</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">#crypto-config.yaml</span><br><span class="line"></span><br><span class="line">OrdererOrgs: </span><br><span class="line">  - Name: Orderer </span><br><span class="line">    Domain: consortiums.com </span><br><span class="line">    Specs: </span><br><span class="line">      - Hostname: orderer0 </span><br><span class="line">      - Hostname: orderer1 </span><br><span class="line">      - Hostname: orderer2 </span><br><span class="line">      - Hostname: orderer3 </span><br><span class="line">      - Hostname: orderer4 </span><br><span class="line">PeerOrgs: </span><br><span class="line">  - Name: Org1 </span><br><span class="line">    Domain: org1.com </span><br><span class="line">    EnableNodeOUs: true </span><br><span class="line">    Template: </span><br><span class="line">      Count: 2 #生成证书的数量 </span><br><span class="line">    Users: </span><br><span class="line">      Count: 1 #生成用户证书个数 </span><br><span class="line">  - Name: Org2 </span><br><span class="line">    Domain: org2.com </span><br><span class="line">    EnableNodeOUs: true </span><br><span class="line">    Template: </span><br><span class="line">      Count: 2 </span><br><span class="line">    Users: </span><br><span class="line">      Count: 1</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br></pre></td><td class="code"><pre><span class="line">#configtx.yaml</span><br><span class="line"></span><br><span class="line">--- </span><br><span class="line">Organizations: </span><br><span class="line">  - &amp;OrdererOrg </span><br><span class="line">        Name: OrdererOrg </span><br><span class="line">        ID: OrdererMSP </span><br><span class="line">        MSPDir: /root/fabric_cluster/crypto-config/ordererOrganizations/consortiums.com/msp </span><br><span class="line">        Policies: </span><br><span class="line">            Readers: </span><br><span class="line">                Type: Signature </span><br><span class="line">                Rule: &quot;OR(&#x27;OrdererMSP.member&#x27;)&quot; </span><br><span class="line">            Writers: </span><br><span class="line">                Type: Signature </span><br><span class="line">                Rule: &quot;OR(&#x27;OrdererMSP.member&#x27;)&quot; </span><br><span class="line">            Admins: </span><br><span class="line">                Type: Signature </span><br><span class="line">                Rule: &quot;OR(&#x27;OrdererMSP.admin&#x27;)&quot; </span><br><span class="line">  - &amp;Org1 </span><br><span class="line">        Name: Org1MSP </span><br><span class="line">        ID: Org1MSP </span><br><span class="line">        MSPDir: /root/fabric_cluster/crypto-config/peerOrganizations/org1.com/msp </span><br><span class="line">        Policies: </span><br><span class="line">            Readers: </span><br><span class="line">                Type: Signature </span><br><span class="line">                Rule: &quot;OR(&#x27;Org1MSP.admin&#x27;, &#x27;Org1MSP.peer&#x27;, &#x27;Org1MSP.client&#x27;)&quot; </span><br><span class="line">            Writers: </span><br><span class="line">                Type: Signature </span><br><span class="line">                Rule: &quot;OR(&#x27;Org1MSP.admin&#x27;, &#x27;Org1MSP.client&#x27;)&quot; </span><br><span class="line">            Admins: </span><br><span class="line">                Type: Signature </span><br><span class="line">                Rule: &quot;OR(&#x27;Org1MSP.admin&#x27;)&quot; </span><br><span class="line">            Endorsement: </span><br><span class="line">                Type: Signature </span><br><span class="line">                Rule: &quot;OR(&#x27;Org1MSP.peer&#x27;)&quot;  </span><br><span class="line">        AnchorPeers: </span><br><span class="line">            - Host: peer0.org1.com </span><br><span class="line">              Port: 7051 </span><br><span class="line">  - &amp;Org2 </span><br><span class="line">        Name: Org2MSP </span><br><span class="line">        ID: Org2MSP </span><br><span class="line">        MSPDir: /root/fabric_cluster/crypto-config/peerOrganizations/org2.com/msp </span><br><span class="line">        Policies: </span><br><span class="line">            Readers: </span><br><span class="line">                Type: Signature </span><br><span class="line">                Rule: &quot;OR(&#x27;Org2MSP.admin&#x27;, &#x27;Org2MSP.peer&#x27;, &#x27;Org2MSP.client&#x27;)&quot; </span><br><span class="line">            Writers: </span><br><span class="line">                Type: Signature </span><br><span class="line">                Rule: &quot;OR(&#x27;Org2MSP.admin&#x27;, &#x27;Org2MSP.client&#x27;)&quot; </span><br><span class="line">            Admins: </span><br><span class="line">                Type: Signature </span><br><span class="line">                Rule: &quot;OR(&#x27;Org2MSP.admin&#x27;)&quot; </span><br><span class="line">            Endorsement: </span><br><span class="line">                Type: Signature </span><br><span class="line">                Rule: &quot;OR(&#x27;Org2MSP.peer&#x27;)&quot; </span><br><span class="line"> </span><br><span class="line">        AnchorPeers: </span><br><span class="line">            - Host: peer0.org2.com </span><br><span class="line">              Port: 7051 </span><br><span class="line">Capabilities: </span><br><span class="line">    Channel: &amp;ChannelCapabilities </span><br><span class="line">        V2_0: true </span><br><span class="line">    Orderer: &amp;OrdererCapabilities </span><br><span class="line">        V2_0: true </span><br><span class="line">    Application: &amp;ApplicationCapabilities </span><br><span class="line">        V2_0: true </span><br><span class="line">Application: &amp;ApplicationDefaults  </span><br><span class="line">    Organizations:  </span><br><span class="line">    Policies: </span><br><span class="line">        Readers: </span><br><span class="line">            Type: ImplicitMeta </span><br><span class="line">            Rule: &quot;ANY Readers&quot; </span><br><span class="line">        Writers: </span><br><span class="line">            Type: ImplicitMeta </span><br><span class="line">            Rule: &quot;ANY Writers&quot; </span><br><span class="line">        Admins: </span><br><span class="line">            Type: ImplicitMeta </span><br><span class="line">            Rule: &quot;MAJORITY Admins&quot; </span><br><span class="line">        LifecycleEndorsement: </span><br><span class="line">            Type: ImplicitMeta </span><br><span class="line">            Rule: &quot;MAJORITY Endorsement&quot; </span><br><span class="line">        Endorsement: </span><br><span class="line">            Type: ImplicitMeta </span><br><span class="line">            Rule: &quot;MAJORITY Endorsement&quot; </span><br><span class="line"> </span><br><span class="line">    Capabilities: </span><br><span class="line">        &lt;&lt;: *ApplicationCapabilities</span><br><span class="line">Orderer: &amp;OrdererDefaults  </span><br><span class="line">    OrdererType: etcdraft  </span><br><span class="line">    Addresses: # 排序节点集群</span><br><span class="line">        - orderer0.consortiums.com:7050 </span><br><span class="line">        - orderer1.consortiums.com:7050 </span><br><span class="line">        - orderer2.consortiums.com:7050 </span><br><span class="line">        - orderer3.consortiums.com:7050 </span><br><span class="line">        - orderer4. consortiums.com:7050 </span><br><span class="line">    # 打包区块的最长时间间隔，即每2s执行一次打包区块 </span><br><span class="line">    BatchTimeout: 2s  </span><br><span class="line">    # 指定区块中可以包含的最大交易上限 </span><br><span class="line">    BatchSize: </span><br><span class="line">        MaxMessageCount: 10  </span><br><span class="line">        AbsoluteMaxBytes: 99 MB  </span><br><span class="line">        PreferredMaxBytes: 512 KB  </span><br><span class="line">    Organizations:  </span><br><span class="line">    Policies: </span><br><span class="line">        Readers: </span><br><span class="line">            Type: ImplicitMeta </span><br><span class="line">            Rule: &quot;ANY Readers&quot; </span><br><span class="line">        Writers: </span><br><span class="line">            Type: ImplicitMeta </span><br><span class="line">            Rule: &quot;ANY Writers&quot; </span><br><span class="line">        Admins: </span><br><span class="line">            Type: ImplicitMeta </span><br><span class="line">            Rule: &quot;MAJORITY Admins&quot; </span><br><span class="line">        # 指定从排序节点发送到沿着节点的区中必须包含任意有写权限节点的签名 </span><br><span class="line">        BlockValidation: </span><br><span class="line">            Type: ImplicitMeta </span><br><span class="line">            Rule: &quot;ANY Writers&quot; </span><br><span class="line">Channel: &amp;ChannelDefaults  </span><br><span class="line">    Policies: </span><br><span class="line">        # 指定谁可以调用&#x27;Deliver&#x27; API </span><br><span class="line">        Readers: </span><br><span class="line">            Type: ImplicitMeta </span><br><span class="line">            Rule: &quot;ANY Readers&quot; </span><br><span class="line">        # 指定谁可以调用 &#x27;Broadcast&#x27; API </span><br><span class="line">        Writers: </span><br><span class="line">            Type: ImplicitMeta </span><br><span class="line">            Rule: &quot;ANY Writers&quot; </span><br><span class="line">        # 指定谁可以修改通道配置 </span><br><span class="line">        Admins: </span><br><span class="line">            Type: ImplicitMeta </span><br><span class="line">            Rule: &quot;MAJORITY Admins&quot;  </span><br><span class="line">    Capabilities: </span><br><span class="line">        &lt;&lt;: *ChannelCapabilities</span><br><span class="line"></span><br><span class="line">Profiles:</span><br><span class="line">    TwoOrgsChannel: </span><br><span class="line">        Consortium: SampleConsortium </span><br><span class="line">        &lt;&lt;: *ChannelDefaults </span><br><span class="line">        Application: </span><br><span class="line">            &lt;&lt;: *ApplicationDefaults </span><br><span class="line">            Organizations: </span><br><span class="line">                - *Org1 </span><br><span class="line">                - *Org2 </span><br><span class="line">            Capabilities: </span><br><span class="line">                &lt;&lt;: *ApplicationCapabilities </span><br><span class="line"></span><br><span class="line">    SampleMultiNodeEtcdRaft: </span><br><span class="line">        &lt;&lt;: *ChannelDefaults </span><br><span class="line">        Capabilities: </span><br><span class="line">            &lt;&lt;: *ChannelCapabilities </span><br><span class="line">        Orderer: </span><br><span class="line">            &lt;&lt;: *OrdererDefaults </span><br><span class="line">            OrdererType: etcdraft </span><br><span class="line">            EtcdRaft: </span><br><span class="line">                Consenters: </span><br><span class="line">                - Host: orderer0.consortiums.com </span><br><span class="line">                  Port: 7050 </span><br><span class="line">                  ClientTLSCert: /root/fabric_cluster/crypto-config/ordererOrganizations/consortiums.com/orderers/orderer0.consortiums.com/tls/server.crt </span><br><span class="line">                  ServerTLSCert: /root/fabric_cluster/crypto-config/ordererOrganizations/consortiums.com/orderers/orderer0.consortiums.com/tls/server.crt </span><br><span class="line">                - Host: orderer1.consortiums.com</span><br><span class="line">                  Port: 7050 </span><br><span class="line">                  ClientTLSCert: /root/fabric_cluster/crypto-config/ordererOrganizations/consortiums.com/orderers/orderer1.consortiums.com/tls/server.crt </span><br><span class="line">                  ServerTLSCert: /root/fabric_cluster/crypto-config/ordererOrganizations/consortiums.com/orderers/orderer1.consortiums.com/tls/server.crt </span><br><span class="line">                - Host: orderer2.consortiums.com</span><br><span class="line">                  Port: 7050 </span><br><span class="line">                  ClientTLSCert: /root/fabric_cluster/crypto-config/ordererOrganizations/consortiums.com/orderers/orderer2.consortiums.com/tls/server.crt </span><br><span class="line">                  ServerTLSCert: /root/fabric_cluster/crypto-config/ordererOrganizations/consortiums.com/orderers/orderer2.consortiums.com/tls/server.crt </span><br><span class="line">                - Host: orderer3.consortiums.com</span><br><span class="line">                  Port: 7050 </span><br><span class="line">                  ClientTLSCert: /root/fabric_cluster/crypto-config/ordererOrganizations/consortiums.com/orderers/orderer3.consortiums.com/tls/server.crt </span><br><span class="line">                  ServerTLSCert: /root/fabric_cluster/crypto-config/ordererOrganizations/consortiums.com/orderers/orderer3.consortiums.com/tls/server.crt </span><br><span class="line">                - Host: orderer4.consortiums.com</span><br><span class="line">                  Port: 7050 </span><br><span class="line">                  ClientTLSCert: /root/fabric_cluster/crypto-config/ordererOrganizations/consortiums.com/orderers/orderer4.consortiums.com/tls/server.crt </span><br><span class="line">                  ServerTLSCert: /root/fabric_cluster/crypto-config/ordererOrganizations/consortiums.com/orderers/orderer4.consortiums.com/tls/server.crt </span><br><span class="line">            Addresses: </span><br><span class="line">                - orderer0.consortiums.com:7050 </span><br><span class="line">                - orderer1.consortiums.com:7050 </span><br><span class="line">                - orderer2.consortiums.com:7050 </span><br><span class="line">                - orderer3.consortiums.com:7050 </span><br><span class="line">                - orderer4.consortiums.com:7050 </span><br><span class="line">            Organizations: </span><br><span class="line">            - *OrdererOrg </span><br><span class="line">            Capabilities: </span><br><span class="line">                &lt;&lt;: *OrdererCapabilities </span><br><span class="line">        Application: </span><br><span class="line">            &lt;&lt;: *ApplicationDefaults </span><br><span class="line">            Organizations: </span><br><span class="line">            - &lt;&lt;: *OrdererOrg </span><br><span class="line">        Consortiums: </span><br><span class="line">            SampleConsortium: </span><br><span class="line">                Organizations: </span><br><span class="line">                - *Org1 </span><br><span class="line">                - *Org2</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">#base.yaml</span><br><span class="line"></span><br><span class="line">version: &#x27;2&#x27;  # 语法格式版本</span><br><span class="line"> </span><br><span class="line">services: </span><br><span class="line">  order-base: # 在docker-compose-up.yaml中会通过该名字引入下面的配置</span><br><span class="line">    image: hyperledger/fabric-orderer  #使用的Docker镜像</span><br><span class="line">    environment: </span><br><span class="line">      - FABRIC_LOGGING_SPEC=DEBUG   #日志级别</span><br><span class="line">      - ORDERER_GENERAL_LISTENADDRESS=0.0.0.0   #排序节点的监听地址</span><br><span class="line">      - ORDERER_GENERAL_LISTENPORT=7050   #排序节点的监听端口</span><br><span class="line">      - ORDERER_GENERAL_BOOTSTRAPMETHOD=file   #启动排序节点的方法</span><br><span class="line">      - ORDERER_GENERAL_BOOTSTRAPFILE=/var/hyperledger/orderer/orderer.genesis.block # 创世区块的路径</span><br><span class="line">      - ORDERER_GENERAL_LOCALMSPID=OrdererMSP  #节点所属组织的MSP唯一标识，需与系统通道配置中保持一致</span><br><span class="line">      - ORDERER_GENERAL_LOCALMSPDIR=/var/hyperledger/orderer/msp # msp文件所在目录</span><br><span class="line">      - ORDERER_GENERAL_TLS_ENABLED=true # 启用 TLS</span><br><span class="line">      - ORDERER_GENERAL_TLS_PRIVATEKEY=/var/hyperledger/orderer/tls/server.key #排序节点使用的TLS私钥文件</span><br><span class="line">      - ORDERER_GENERAL_TLS_CERTIFICATE=/var/hyperledger/orderer/tls/server.crt # 排序节点使用的TLS服务端证书文件</span><br><span class="line">      - ORDERER_GENERAL_TLS_ROOTCAS=[/var/hyperledger/orderer/tls/ca.crt] # 排序节点使用的TLS CA信任根证书，用于校验客户端证书</span><br><span class="line">      - ORDERER_GENERAL_CLUSTER_CLIENTCERTIFICATE=/var/hyperledger/orderer/tls/server.crt #客户端证书文件，访问其他orderer节点时需要TLS双向认证</span><br><span class="line">      - ORDERER_GENERAL_CLUSTER_CLIENTPRIVATEKEY=/var/hyperledger/orderer/tls/server.key </span><br><span class="line">      - ORDERER_GENERAL_CLUSTER_ROOTCAS=[/var/hyperledger/orderer/tls/ca.crt] # 客户端私钥文件</span><br><span class="line">    working_dir: /root/fabric_cluster/opt  # 工作目录，即Docker容器的挂载目录</span><br><span class="line">    command: orderer #容器启动后默认执行的命令</span><br><span class="line">    volumes: </span><br><span class="line">        - /root/fabric_cluster/channel-artifacts/genesis.block:/var/hyperledger/orderer/orderer.genesis.block  #将宿主机中的创世区块映射到Docker容器中</span><br><span class="line"></span><br><span class="line">  peer-base: # 在docker-compose-up.yaml中会通过该名字引入下面的配置</span><br><span class="line">    image: hyperledger/fabric-peer #使用的Docker镜像</span><br><span class="line">    environment: #定义环境变量</span><br><span class="line">      - CORE_VM_ENDPOINT=unix:///host/var/run/docker.sock #虚拟机管理系统的访问端节点</span><br><span class="line">      - FABRIC_LOGGING_SPEC=DEBUG  #日志级别</span><br><span class="line">      - CORE_PEER_TLS_ENABLED=true  #启用TLS</span><br><span class="line">      - CORE_PEER_GOSSIP_USELEADERELECTION=true #节点是否使用动态算法选出领导节点</span><br><span class="line">      - CORE_PEER_GOSSIP_ORGLEADER=false # 是否静态指定组织的领导节点</span><br><span class="line">      - CORE_PEER_PROFILE_ENABLED=true  #是否启用HTTP分析服务</span><br><span class="line">      - CORE_PEER_TLS_CERT_FILE=/etc/hyperledger/fabric/tls/server.crt # Peer节点的证书文件路径</span><br><span class="line">      - CORE_PEER_TLS_KEY_FILE=/etc/hyperledger/fabric/tls/server.key  # Peer节点的私钥文件路径</span><br><span class="line">      - CORE_PEER_TLS_ROOTCERT_FILE=/etc/hyperledger/fabric/tls/ca.crt # Peer节点的验证根证书文件路径</span><br><span class="line">      - CORE_CHAINCODE_EXECUTETIMEOUT=300s #在初始化和调用链码方法时节点等待的超时时间</span><br><span class="line">    working_dir: /root/fabric_cluster/opt/peer  #工作目录</span><br><span class="line">    command: peer node start </span><br><span class="line">    volumes: </span><br><span class="line">       - /var/run/:/host/var/run/</span><br><span class="line"></span><br><span class="line">  cli-base: # 在docker-compose-up.yaml中会通过该名字引入下面的配置</span><br><span class="line">    image: hyperledger/fabric-tools #使用的Docker镜像</span><br><span class="line">    tty: true </span><br><span class="line">    stdin_open: true </span><br><span class="line">    environment: #环境变量</span><br><span class="line">      - GOPATH=/root/go  #Go语言项目目录</span><br><span class="line">      - CORE_VM_ENDPOINT=unix:///host/var/run/docker.sock #虚拟机管理系统的访问端节点</span><br><span class="line">      - FABRIC_LOGGING_SPEC=DEBUG  #日志级别</span><br><span class="line">      - CORE_PEER_TLS_ENABLED=true #启用TLS</span><br><span class="line">    working_dir: / root/fabric_cluster/opt/peer  #工作目录</span><br><span class="line">    command: /bin/bash </span><br><span class="line">    volumes: </span><br><span class="line">        - /var/run/:/host/var/run/ </span><br><span class="line">        - / root/fabric_cluster/chaincode/go/:/hyperledger/cluster/chaincode/go # 存储链码的目录</span><br><span class="line">        - /root/fabric_cluster/crypto-config:/hyperledger/opt/peer/crypto-config/ </span><br><span class="line">        - /root/fabric_cluster/channel-artifacts:/hyperledger/opt/peer/channel-artifacts </span><br><span class="line"></span><br><span class="line">  ca-base:</span><br><span class="line">    image: hyperledger/fabric-ca</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br></pre></td><td class="code"><pre><span class="line">#docker-compose-up.yaml</span><br><span class="line"></span><br><span class="line">version: &#x27;2&#x27;</span><br><span class="line"> </span><br><span class="line">services:</span><br><span class="line">  orderer0.consortiums.com:</span><br><span class="line">    container_name: orderer0.consortiums.com  #容器名</span><br><span class="line">    extends:  #引入base.yaml中定义的配置项</span><br><span class="line">      file: base.yaml</span><br><span class="line">      service: order-base</span><br><span class="line">    volumes: #定义宿主机文件夹到容器中卷的映射关系</span><br><span class="line">      - /root/fabric_cluster/crypto-config/ordererOrganizations/consortiums.com/orderers/orderer0.consortiums.com/msp:/var/hyperledger/orderer/msp</span><br><span class="line">      - /root/fabric_cluster/crypto-config/ordererOrganizations/consortiums.com/orderers/orderer0.consortiums.com/tls/:/var/hyperledger/orderer/tls</span><br><span class="line">    ports: # 定义宿主机端和容器中端口的映射关系</span><br><span class="line">      - 7050:7050</span><br><span class="line">  orderer1.consortiums.com:</span><br><span class="line">    container_name: orderer1.consortiums.com</span><br><span class="line">    extends:</span><br><span class="line">      file: base.yaml</span><br><span class="line">      service: order-base</span><br><span class="line">    volumes:</span><br><span class="line">      - /root/fabric_cluster/crypto-config/ordererOrganizations/consortiums.com/orderers/orderer1.consortiums.com/msp:/var/hyperledger/orderer/msp</span><br><span class="line">      - /root/fabric_cluster/crypto-config/ordererOrganizations/consortiums.com/orderers/orderer1.consortiums.com/tls/:/var/hyperledger/orderer/tls</span><br><span class="line">    ports:</span><br><span class="line">      - 8050:7050</span><br><span class="line">  orderer2.consortiums.com:</span><br><span class="line">    container_name: orderer2.consortiums.com</span><br><span class="line">    extends:</span><br><span class="line">      file: base.yaml</span><br><span class="line">      service: order-base</span><br><span class="line">    volumes:</span><br><span class="line">      - /root/fabric_cluster/crypto-config/ordererOrganizations/consortiums.com/orderers/orderer2.consortiums.com/msp:/var/hyperledger/orderer/msp</span><br><span class="line">      - /root/fabric_cluster/crypto-config/ordererOrganizations/consortiums.com/orderers/orderer2.consortiums.com/tls/:/var/hyperledger/orderer/tls</span><br><span class="line">    ports:</span><br><span class="line">      - 9050:7050  </span><br><span class="line">  orderer3.consortiums.com:</span><br><span class="line">    container_name: orderer3.consortiums.com</span><br><span class="line">    extends:</span><br><span class="line">      file: base.yaml</span><br><span class="line">      service: order-base</span><br><span class="line">    volumes:</span><br><span class="line">        - /root/fabric_cluster/crypto-config/ordererOrganizations/consortiums.com/orderers/orderer3.consortiums.com/msp:/var/hyperledger/orderer/msp</span><br><span class="line">        - /root/fabric_cluster/crypto-config/ordererOrganizations/consortiums.com/orderers/orderer3.consortiums.com/tls/:/var/hyperledger/orderer/tls</span><br><span class="line">    ports:</span><br><span class="line">      - 10050:7050</span><br><span class="line">  orderer4.consortiums.com:</span><br><span class="line">    container_name: orderer4.consortiums.com</span><br><span class="line">    extends:</span><br><span class="line">      file: base.yaml</span><br><span class="line">      service: order-base</span><br><span class="line">    volumes:</span><br><span class="line">        - /root/fabric_cluster/crypto-config/ordererOrganizations/consortiums.com/orderers/orderer4.consortiums.com/msp:/var/hyperledger/orderer/msp</span><br><span class="line">        - /root/fabric_cluster/crypto-config/ordererOrganizations/consortiums.com/orderers/orderer4.consortiums.com/tls/:/var/hyperledger/orderer/tls</span><br><span class="line">    ports:</span><br><span class="line">      - 11050:7050</span><br><span class="line"></span><br><span class="line">  peer0.org1.com:</span><br><span class="line">    container_name: peer0.org1.com</span><br><span class="line">    extends:</span><br><span class="line">      file: base.yaml</span><br><span class="line">      service: peer-base</span><br><span class="line">    environment:</span><br><span class="line">      - CORE_PEER_ID=peer0.org1.com #Peer节点实例的标识ID</span><br><span class="line">      - CORE_PEER_ADDRESS=peer0.org1.com:7051 #Peer节点的P2P连接地址</span><br><span class="line">      - CORE_PEER_LISTENADDRESS=0.0.0.0:7051 #Peer节点的监听地址</span><br><span class="line">      - CORE_PEER_CHAINCODEADDRESS=peer0.org1.com:7052 #链码连接该Peer节点的地址</span><br><span class="line">      - CORE_PEER_CHAINCODELISTENADDRESS=0.0.0.0:7052 # Peer节点监听链码连接请求的地址</span><br><span class="line">      - CORE_PEER_GOSSIP_BOOTSTRAP=peer1.org1.com:8051 #初始化gossip的引导节点列表</span><br><span class="line">      - CORE_PEER_GOSSIP_EXTERNALENDPOINT=peer0.org1.com:7051#向组织外节点发布的访问端点</span><br><span class="line">      - CORE_PEER_LOCALMSPID=Org1MSP #本地MSP的标识ID</span><br><span class="line">    volumes: #定义宿主机文件夹到容器中卷的映射关系</span><br><span class="line">       - /root/fabric_cluster/crypto-config/peerOrganizations/org1.com/peers/peer0.org1.com/msp:/etc/hyperledger/fabric/msp</span><br><span class="line">       - /root/fabric_cluster/crypto-config/peerOrganizations/org1.com/peers/peer0.org1.com/tls:/etc/hyperledger/fabric/tls</span><br><span class="line">    ports:</span><br><span class="line">      - 7051:7051</span><br><span class="line">  peer1.org1.com:</span><br><span class="line">    container_name: peer1.org1.com</span><br><span class="line">    extends:</span><br><span class="line">      file: base.yaml</span><br><span class="line">      service: peer-base</span><br><span class="line">    environment:</span><br><span class="line">      - CORE_PEER_ID=peer1.org1.com</span><br><span class="line">      - CORE_PEER_ADDRESS=peer1.org1.com:8051</span><br><span class="line">      - CORE_PEER_LISTENADDRESS=0.0.0.0:8051</span><br><span class="line">      - CORE_PEER_CHAINCODEADDRESS=peer1.org1.com:8052</span><br><span class="line">      - CORE_PEER_CHAINCODELISTENADDRESS=0.0.0.0:8052</span><br><span class="line">      - CORE_PEER_GOSSIP_BOOTSTRAP=peer0.org1.com:7051</span><br><span class="line">      - CORE_PEER_GOSSIP_EXTERNALENDPOINT=peer1.org1.com:8051</span><br><span class="line">      - CORE_PEER_LOCALMSPID=Org1MSP</span><br><span class="line">    volumes:</span><br><span class="line">       - /root/fabric_cluster/crypto-config/peerOrganizations/org1.com/peers/peer1.org1.com/msp:/etc/hyperledger/fabric/msp</span><br><span class="line">       - /root/fabric_cluster/crypto-config/peerOrganizations/org1.com/peers/peer1.org1.com/tls:/etc/hyperledger/fabric/tls</span><br><span class="line">    ports:</span><br><span class="line">      - 8051:8051</span><br><span class="line"></span><br><span class="line">  peer0.org2.com:</span><br><span class="line">    container_name: peer0.org2.com</span><br><span class="line">    extends:</span><br><span class="line">      file: base.yaml</span><br><span class="line">      service: peer-base</span><br><span class="line">    environment:</span><br><span class="line">      - CORE_PEER_ID=peer0.org2.com</span><br><span class="line">      - CORE_PEER_ADDRESS=peer0.org2.com:9051</span><br><span class="line">      - CORE_PEER_LISTENADDRESS=0.0.0.0:9051</span><br><span class="line">      - CORE_PEER_CHAINCODEADDRESS=peer0.org2.com:9052</span><br><span class="line">      - CORE_PEER_CHAINCODELISTENADDRESS=0.0.0.0:9052</span><br><span class="line">      - CORE_PEER_GOSSIP_BOOTSTRAP=peer1.org2.com:10051</span><br><span class="line">      - CORE_PEER_GOSSIP_EXTERNALENDPOINT=peer0.org2.com:9051</span><br><span class="line">      - CORE_PEER_LOCALMSPID=Org2MSP</span><br><span class="line">    volumes:</span><br><span class="line">       - /root/fabric_cluster/crypto-config/peerOrganizations/org2.com/peers/peer0.org2.com/msp:/etc/hyperledger/fabric/msp</span><br><span class="line">       - /root/fabric_cluster/crypto-config/peerOrganizations/org2.com/peers/peer0.org2.com/tls:/etc/hyperledger/fabric/tls</span><br><span class="line">    ports:</span><br><span class="line">      - 9051:9051</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  peer1.org2.com:</span><br><span class="line">    container_name: peer1.org2.com</span><br><span class="line">    extends:</span><br><span class="line">      file: base.yaml</span><br><span class="line">      service: peer-base</span><br><span class="line">    environment:</span><br><span class="line">      - CORE_PEER_ID=peer1.org2.com</span><br><span class="line">      - CORE_PEER_ADDRESS=peer1.org2.com:10051</span><br><span class="line">      - CORE_PEER_LISTENADDRESS=0.0.0.0:10051</span><br><span class="line">      - CORE_PEER_CHAINCODEADDRESS=peer1.org2.com:10052</span><br><span class="line">      - CORE_PEER_CHAINCODELISTENADDRESS=0.0.0.0:10052</span><br><span class="line">      - CORE_PEER_GOSSIP_BOOTSTRAP=peer0.org2.com:9051</span><br><span class="line">      - CORE_PEER_GOSSIP_EXTERNALENDPOINT=peer1.org2.com:10051</span><br><span class="line">      - CORE_PEER_LOCALMSPID=Org2MSP</span><br><span class="line">    volumes:</span><br><span class="line">       - /root/fabric_cluster/crypto-config/peerOrganizations/org2.com/peers/peer1.org2.com/msp:/etc/hyperledger/fabric/msp</span><br><span class="line">       - /root/fabric_cluster/crypto-config/peerOrganizations/org2.com/peers/peer1.org2.com/tls:/etc/hyperledger/fabric/tls</span><br><span class="line">    ports:</span><br><span class="line">      - 10051:10051</span><br><span class="line"></span><br><span class="line">  cli-peer0-org1:</span><br><span class="line">    container_name: cli-peer0-org1</span><br><span class="line">    extends:</span><br><span class="line">      file: base.yaml</span><br><span class="line">      service: cli-base</span><br><span class="line">    environment:</span><br><span class="line">      - CORE_PEER_ID=cli-peer0-org1</span><br><span class="line">      - CORE_PEER_ADDRESS=peer0.org1.com:7051</span><br><span class="line">      - CORE_PEER_LOCALMSPID=Org1MSP</span><br><span class="line">      - CORE_PEER_TLS_CERT_FILE=/hyperledger/opt/peer/crypto-config/peerOrganizations/org1.com/peers/peer0.org1.com/tls/server.crt</span><br><span class="line">      - CORE_PEER_TLS_KEY_FILE=/hyperledger/opt/peer/crypto-config/peerOrganizations/org1.com/peers/peer0.org1.com/tls/server.key</span><br><span class="line">      - CORE_PEER_TLS_ROOTCERT_FILE=/hyperledger/opt/peer/crypto-config/peerOrganizations/org1.com/peers/peer0.org1.com/tls/ca.crt</span><br><span class="line">      - CORE_PEER_MSPCONFIGPATH=/hyperledger/opt/peer/crypto-config/peerOrganizations/org1.com/users/Admin@org1.com/msp</span><br><span class="line"></span><br><span class="line">  cli-peer1-org1:</span><br><span class="line">    container_name: cli-peer1-org1</span><br><span class="line">    extends:</span><br><span class="line">      file: base.yaml</span><br><span class="line">      service: cli-base</span><br><span class="line">    environment:</span><br><span class="line">      - CORE_PEER_ID=cli-peer1-org1</span><br><span class="line">      - CORE_PEER_ADDRESS=peer1.org1.com:8051</span><br><span class="line">      - CORE_PEER_LOCALMSPID=Org1MSP</span><br><span class="line">      - CORE_PEER_TLS_CERT_FILE=/hyperledger/opt/peer/crypto-config/peerOrganizations/org1.com/peers/peer1.org1.com/tls/server.crt</span><br><span class="line">      - CORE_PEER_TLS_KEY_FILE=/hyperledger/opt/peer/crypto-config/peerOrganizations/org1.com/peers/peer1.org1.com/tls/server.key</span><br><span class="line">      - CORE_PEER_TLS_ROOTCERT_FILE=/hyperledger/opt/peer/crypto-config/peerOrganizations/org1.com/peers/peer1.org1.com/tls/ca.crt</span><br><span class="line">      - CORE_PEER_MSPCONFIGPATH=/hyperledger/opt/peer/crypto-config/peerOrganizations/org1.com/users/Admin@org1.com/msp</span><br><span class="line"></span><br><span class="line">  cli-peer0-org2:</span><br><span class="line">    container_name: cli-peer0-org2</span><br><span class="line">    extends:</span><br><span class="line">      file: base.yaml</span><br><span class="line">      service: cli-base</span><br><span class="line">    environment:</span><br><span class="line">      - CORE_PEER_ID=cli-peer0-org2</span><br><span class="line">      - CORE_PEER_ADDRESS=peer0.org2.com:9051</span><br><span class="line">      - CORE_PEER_LOCALMSPID=Org2MSP</span><br><span class="line">      - CORE_PEER_TLS_CERT_FILE=/hyperledger/opt/peer/crypto-config/peerOrganizations/org2.com/peers/peer0.org2.com/tls/server.crt</span><br><span class="line">      - CORE_PEER_TLS_KEY_FILE=/hyperledger/opt/peer/crypto-config/peerOrganizations/org2.com/peers/peer0.org2.com/tls/server.key</span><br><span class="line">      - CORE_PEER_TLS_ROOTCERT_FILE=/hyperledger/opt/peer/crypto-config/peerOrganizations/org2.com/peers/peer0.org2.com/tls/ca.crt</span><br><span class="line">      - CORE_PEER_MSPCONFIGPATH=/hyperledger/opt/peer/crypto-config/peerOrganizations/org2.com/users/Admin@org2.com/msp</span><br><span class="line"> </span><br><span class="line">  cli-peer1-org2:</span><br><span class="line">    container_name: cli-peer1-org2</span><br><span class="line">    extends:</span><br><span class="line">      file: base.yaml</span><br><span class="line">      service: cli-base</span><br><span class="line">    environment:</span><br><span class="line">      - CORE_PEER_ID=cli-peer1-org2</span><br><span class="line">      - CORE_PEER_ADDRESS=peer1.org2.com:10051</span><br><span class="line">      - CORE_PEER_LOCALMSPID=Org2MSP</span><br><span class="line">      - CORE_PEER_TLS_CERT_FILE=/hyperledger/opt/peer/crypto-config/peerOrganizations/org2.com/peers/peer1.org2.com/tls/server.crt</span><br><span class="line">      - CORE_PEER_TLS_KEY_FILE=/hyperledger/opt/peer/crypto-config/peerOrganizations/org2.com/peers/peer1.org2.com/tls/server.key</span><br><span class="line">      - CORE_PEER_TLS_ROOTCERT_FILE=/hyperledger/opt/peer/crypto-config/peerOrganizations/org2.com/peers/peer1.org2.com/tls/ca.crt</span><br><span class="line">      - CORE_PEER_MSPCONFIGPATH=/hyperledger/opt/peer/crypto-config/peerOrganizations/org2.com/users/Admin@org2.com/msp</span><br><span class="line"></span><br><span class="line">  ca-org1:</span><br><span class="line">    container_name: ca-org1</span><br><span class="line">    extends:</span><br><span class="line">      file: base.yaml</span><br><span class="line">      service: ca-base</span><br><span class="line">    environment:</span><br><span class="line">      - FABRIC_CA_SERVER_CA_NAME=ca-org1</span><br><span class="line">      - FABRIC_CA_SERVER_CA_CERTFILE=/etc/hyperledger/fabric-ca-server-config/ca.org1.com-cert.pem</span><br><span class="line">      - FABRIC_CA_SERVER_CA_KEYFILE=/etc/hyperledger/fabric-ca-server-config/MIGHAgEAMBMGByqGSM49AgEGCCqGSM49AwEHBG0wawIBAQQg4Hwt/FeN1y7ePgsRCXgkX0om4wKggwkkQC6R6Sdwg2mhRANCAARAysXo0jF5Az5jUObnGRNHU6kvCCAI2n/8uFdOo/i8iPvB/8BTtgrx+rSl6f/oVnw9vRNlVOEW/ZfB03/e3epu</span><br><span class="line">      - FABRIC_CA_SERVER_TLS_CERTFILE=/etc/hyperledger/fabric-ca-server-config/ca.org1.com-cert.pem</span><br><span class="line">      - FABRIC_CA_SERVER_TLS_KEYFILE=/etc/hyperledger/fabric-ca-server-config/MIGHAgEAMBMGByqGSM49AgEGCCqGSM49AwEHBG0wawIBAQQg4Hwt/FeN1y7ePgsRCXgkX0om4wKggwkkQC6R6Sdwg2mhRANCAARAysXo0jF5Az5jUObnGRNHU6kvCCAI2n/8uFdOo/i8iPvB/8BTtgrx+rSl6f/oVnw9vRNlVOEW/ZfB03/e3epu</span><br><span class="line">    ports:</span><br><span class="line">      - 7054:7054</span><br><span class="line">    command: sh -c &#x27;fabric-ca-server start -b admin:adminpw -d&#x27;</span><br><span class="line">    volumes:</span><br><span class="line">      - /root/fabric_cluster/crypto-config/peerOrganizations/org1.com/ca:/etc/hyperledger/fabric-ca-server-config</span><br><span class="line">  ca-org2:</span><br><span class="line">    container_name: ca-org2</span><br><span class="line">    extends:</span><br><span class="line">      file: base.yaml</span><br><span class="line">      service: ca-base</span><br><span class="line">    environment:</span><br><span class="line">      - FABRIC_CA_SERVER_CA_NAME=ca-org2</span><br><span class="line">      - FABRIC_CA_SERVER_CA_CERTFILE=/etc/hyperledger/fabric-ca-server-config/ca.org2.com-cert.pem</span><br><span class="line">      - FABRIC_CA_SERVER_CA_KEYFILE=/etc/hyperledger/fabric-ca-server-config/MIGHAgEAMBMGByqGSM49AgEGCCqGSM49AwEHBG0wawIBAQQgSAjLaVDM5Zahbnm6fo9cNGe3/aSGMH5ThCC30YJXlfihRANCAAR8/093Yml+C6HBLaH3JN0QpvTPV4Ks52ViBalBghhSCRfgJMBlUawEyavvuwUWUm0OH835p7kW9JTxL+eKy3Sn</span><br><span class="line">      - FABRIC_CA_SERVER_TLS_CERTFILE=/etc/hyperledger/fabric-ca-server-config/ca.org2.com-cert.pem</span><br><span class="line">      - FABRIC_CA_SERVER_TLS_KEYFILE=/etc/hyperledger/fabric-ca-server-config/MIGHAgEAMBMGByqGSM49AgEGCCqGSM49AwEHBG0wawIBAQQgSAjLaVDM5Zahbnm6fo9cNGe3/aSGMH5ThCC30YJXlfihRANCAAR8/093Yml+C6HBLaH3JN0QpvTPV4Ks52ViBalBghhSCRfgJMBlUawEyavvuwUWUm0OH835p7kW9JTxL+eKy3Sn</span><br><span class="line">    ports:</span><br><span class="line">      - 8054:7054</span><br><span class="line">    command: sh -c &#x27;fabric-ca-server start -b admin:adminpw -d&#x27;</span><br><span class="line">    volumes:</span><br><span class="line">      - /root/fabric_cluster/crypto-config/peerOrganizations/org2.com/ca:/etc/hyperledger/fabric-ca-server-config</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="09">09</h2>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br></pre></td><td class="code"><pre><span class="line">#在测试网络中部署链码</span><br><span class="line">./network.sh deployCC -ccn basic -ccp ../asset-transfer-basic/chaincode-go -ccl go</span><br><span class="line"></span><br><span class="line">#设置Go语言的网络代理</span><br><span class="line"></span><br><span class="line">go env -w GOPROXY=https://goproxy.io,direct</span><br><span class="line">go env -w GO111MODULE=on</span><br><span class="line"></span><br><span class="line">#启动测试网络，并创建通道mychannel</span><br><span class="line"></span><br><span class="line">cd /$GOPATH/src/github.com/hyperledger/fabric/scripts/fabric-samples/test-network</span><br><span class="line">./network.sh up</span><br><span class="line">./network.sh createChannel</span><br><span class="line"></span><br><span class="line">#1．准备运行命令的环境</span><br><span class="line">cd /$GOPATH/src/github.com/hyperledger/fabric/scripts/fabric-samples/test-network</span><br><span class="line">export PATH=$&#123;PWD&#125;/../bin:$PATH</span><br><span class="line">export FABRIC_CFG_PATH=$PWD/../config/</span><br><span class="line">export CORE_PEER_TLS_ENABLED=true</span><br><span class="line">export CORE_PEER_LOCALMSPID=&quot;Org1MSP&quot;</span><br><span class="line">export CORE_PEER_TLS_ROOTCERT_FILE=$&#123;PWD&#125;/organizations/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt</span><br><span class="line">export CORE_PEER_MSPCONFIGPATH=$&#123;PWD&#125;/organizations/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp</span><br><span class="line">export CORE_PEER_ADDRESS=localhost:7051</span><br><span class="line"></span><br><span class="line">#【例9-1】  使用peer chaincode invoke命令调用链码中的InitLedger函数</span><br><span class="line">peer chaincode invoke -o localhost:7050 --ordererTLSHostnameOverride orderer.example.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem -C mychannel -n basic --peerAddresses localhost:7051 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt --peerAddresses localhost:9051 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt -c &#x27;&#123;&quot;function&quot;:&quot;InitLedger&quot;,&quot;Args&quot;:[]&#125;&#x27;</span><br><span class="line"></span><br><span class="line">#【例9-2】  使用peer chaincode query命令调用链码通过GetAllAssets函数查询账本中所有资产的信息，命令如下：</span><br><span class="line"></span><br><span class="line">peer chaincode query -C mychannel -n basic -c &#x27;&#123;&quot;Args&quot;:[&quot;GetAllAssets&quot;]&#125;&#x27;</span><br><span class="line"></span><br><span class="line">#【例9-3】  使用peer chaincode invoke命令调用链码的TransferAsset函数将资产asset6转移给Johney，命令如下：</span><br><span class="line"></span><br><span class="line">peer chaincode invoke -o localhost:7050 --ordererTLSHostnameOverride orderer.example.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem -C mychannel -n basic --peerAddresses localhost:7051 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt --peerAddresses localhost:9051 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt -c &#x27;&#123;&quot;function&quot;:&quot;TransferAsset&quot;,&quot;Args&quot;:[&quot;asset6&quot;,&quot;Johney&quot;]&#125;&#x27;</span><br><span class="line"></span><br><span class="line">#【例9-4】  执行peer chaincode query命令调用链码的ReadAsset函数查看资产asset6的详细信息，命令如下：</span><br><span class="line"></span><br><span class="line">peer chaincode query -C mychannel -n basic -c &#x27;&#123;&quot;Args&quot;:[&quot;ReadAsset&quot;,&quot;asset6&quot;]&#125;&#x27;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">因为前面都是查看组织Org1的Peer节点上的账本，这里切换环境变量如下，查看组织Org2的Peer节点上的账本，两个账本的内容应该是一致的。</span><br><span class="line"></span><br><span class="line">#Environment variables for Org2</span><br><span class="line">export CORE_PEER_TLS_ENABLED=true</span><br><span class="line">export CORE_PEER_LOCALMSPID=&quot;Org2MSP&quot;</span><br><span class="line">export CORE_PEER_TLS_ROOTCERT_FILE=$&#123;PWD&#125;/organizations/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt</span><br><span class="line">export CORE_PEER_MSPCONFIGPATH=$&#123;PWD&#125;/organizations/peerOrganizations/org2.example.com/users/Admin@org2.example.com/msp</span><br><span class="line">export CORE_PEER_ADDRESS=localhost:9051</span><br><span class="line"></span><br><span class="line">#首先需要安装gcc、C++编译器以及内核文件，命令如下：</span><br><span class="line"></span><br><span class="line">yum -y install gcc gcc-c++ kernel-devel</span><br><span class="line"></span><br><span class="line">然后执行如下命令，构建orderer、peer和configtxgen工具的二进制文件。</span><br><span class="line"></span><br><span class="line">cd /$GOPATH/src/github.com/hyperledger/fabric/</span><br><span class="line">make orderer peer configtxgen</span><br><span class="line"></span><br><span class="line">#查看构建的结果</span><br><span class="line"></span><br><span class="line">ls /root/gocode/src/github.com/hyperledger/fabric/build/bin</span><br><span class="line"></span><br><span class="line">#设置环境变量</span><br><span class="line">export PATH=$(pwd)/build/bin:$PATH</span><br><span class="line">export FABRIC_CFG_PATH=$(pwd)/sampleconfig</span><br><span class="line"></span><br><span class="line">#3．生成创世区块</span><br><span class="line">sudo mkdir /var/hyperledger</span><br><span class="line">configtxgen -profile SampleDevModeSolo -channelID syschannel -configPath $FABRIC_CFG_PATH -outputBlock $(pwd)/sampleconfig/genesisblock</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">FABRIC_LOGGING_SPEC=chaincode=debug CORE_PEER_CHAINCODELISTENADDRESS=0.0.0.0:7052 peer node start --peer-chaincodedev=true</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#9.5.2  启动排序节点</span><br><span class="line"></span><br><span class="line">ORDERER_GENERAL_GENESISPROFILE=SampleDevModeSolo orderer</span><br><span class="line"></span><br><span class="line">#9.5.3  在开发模式下启动Peer节点</span><br><span class="line">FABRIC_LOGGING_SPEC=chaincode=debug CORE_PEER_CHAINCODELISTENADDRESS=0.0.0.0:7052 peer node start --peer-chaincodedev=true</span><br><span class="line"></span><br><span class="line">#9.5.4  创建通道</span><br><span class="line">configtxgen -channelID ch2 -outputCreateChannelTx ch2.tx -profile SampleSingleMSPChannel -configPath $FABRIC_CFG_PATH</span><br><span class="line"></span><br><span class="line">peer channel create -o 127.0.0.1:7050 -c ch2 -f ch2.tx</span><br><span class="line"></span><br><span class="line">peer channel join -b ch2.block</span><br><span class="line"></span><br><span class="line">#9.5.5  在开发模式下构建链码</span><br><span class="line">cd $GOPATH/src/github.com/hyperledger/fabric/my_contracts/sample9_5</span><br><span class="line">go mod init</span><br><span class="line"></span><br><span class="line">go build -o ./simpleChaincode</span><br><span class="line"></span><br><span class="line">#9.5.6  启动链码</span><br><span class="line">cd $GOPATH/src/github.com/hyperledger/fabric/my_contracts/sample9_5</span><br><span class="line">CORE_CHAINCODE_LOGLEVEL=debug CORE_PEER_TLS_ENABLED=false CORE_CHAINCODE_ID_NAME=simpleChaincode:1.0 ./simpleChaincode -peer.address 127.0.0.1:7052</span><br><span class="line"></span><br><span class="line">#9.5.7  批准和写入链码定义</span><br><span class="line"></span><br><span class="line">#1．批准链码定义</span><br><span class="line">peer lifecycle chaincode approveformyorg  -o 127.0.0.1:7050 --channelID ch2 --name simpleChaincode --version 1.0 --sequence 1 --init-required --signature-policy &quot;OR (&#x27;SampleOrg.member&#x27;)&quot; --package-id simpleChaincode:1.0</span><br><span class="line"></span><br><span class="line">#2．查看通道成员批准链码定义的情况</span><br><span class="line">peer lifecycle chaincode checkcommitreadiness -o 127.0.0.1:7050 --channelID ch2 --name simpleChaincode --version 1.0 --sequence 1 --init-required --signature-policy &quot;OR (&#x27;SampleOrg.member&#x27;)&quot;</span><br><span class="line"></span><br><span class="line">#3．将链码定义写入通道</span><br><span class="line">peer lifecycle chaincode commit -o 127.0.0.1:7050 --channelID ch2 --name simpleChaincode --version 1.0 --sequence 1 --init-required --signature-policy &quot;OR (&#x27;SampleOrg.member&#x27;)&quot; --peerAddresses 127.0.0.1:7051</span><br><span class="line"></span><br><span class="line">#9.5.8  调用链码</span><br><span class="line">CORE_PEER_ADDRESS=127.0.0.1:7051 peer chaincode invoke -o 127.0.0.1:7050 -C ch2 -n simpleChaincode -c &#x27;&#123;&quot;Args&quot;:[&quot;Create&quot;,&quot;a&quot;,&quot;100&quot;]&#125;&#x27; --isInit</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#（1）如果测试网络已经启动，则执行如下命令关闭测试网络，初始化测试环境。</span><br><span class="line"></span><br><span class="line">cd /$GOPATH/src/github.com/hyperledger/fabric/scripts/fabric-samples/test-network</span><br><span class="line">./network.sh down</span><br><span class="line"></span><br><span class="line">#（2）如果之前运行过本实例的链码容器，则执行如下命令删除之前的容器：</span><br><span class="line"></span><br><span class="line">docker rm -f $(docker ps -a | awk &#x27;($2 ~ /dev-peer.*.marblesp.*/) &#123;print $1&#125;&#x27;)</span><br><span class="line">docker rmi -f $(docker images | awk &#x27;($1 ~ /dev-peer.*.marblesp.*/) &#123;print $3&#125;&#x27;)</span><br><span class="line"></span><br><span class="line">#（3）以CouchDB为状态数据库启动测试网络，命令如下：</span><br><span class="line"></span><br><span class="line">cd /$GOPATH/src/github.com/hyperledger/fabric/scripts/fabric-samples/test-network</span><br><span class="line">./network.sh up createChannel -s couchdb</span><br><span class="line"></span><br><span class="line">#（4）设置环境变量，切换为Org1 admin的身份。</span><br><span class="line"></span><br><span class="line">export PATH=$&#123;PWD&#125;/../bin:$PATH</span><br><span class="line">export FABRIC_CFG_PATH=$PWD/../config/</span><br><span class="line">export CORE_PEER_TLS_ENABLED=true</span><br><span class="line">export CORE_PEER_LOCALMSPID=&quot;Org1MSP&quot;</span><br><span class="line">export CORE_PEER_TLS_ROOTCERT_FILE=$&#123;PWD&#125;/organizations/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt</span><br><span class="line">export CORE_PEER_MSPCONFIGPATH=$&#123;PWD&#125;/organizations/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp</span><br><span class="line">export CORE_PEER_ADDRESS=localhost:7051</span><br><span class="line"></span><br><span class="line">#（5）执行如下命令安装本实例的依赖包：</span><br><span class="line"></span><br><span class="line">cd ../chaincode/marbles02_private/go</span><br><span class="line"></span><br><span class="line">go env -w GOPROXY=https://goproxy.cn</span><br><span class="line">GO111MODULE=on</span><br><span class="line">go mod vendor</span><br><span class="line"></span><br><span class="line">（6）执行如下命令，打包marbles链码。</span><br><span class="line"></span><br><span class="line">cd /$GOPATH/src/github.com/hyperledger/fabric/scripts/fabric-samples/test-network</span><br><span class="line">peer lifecycle chaincode package marblesp.tar.gz --path ../chaincode/marbles02_private/go/ --lang golang --label marblesp_1.0</span><br><span class="line"></span><br><span class="line">#（7）执行如下命令，安装链码marbles。</span><br><span class="line"></span><br><span class="line">peer lifecycle chaincode install marblesp.tar.gz</span><br><span class="line"></span><br><span class="line">#（8）将第7步中输出的package ID赋值到环境变量CC_PACKAGE_ID中，命令如下：</span><br><span class="line"></span><br><span class="line">export CC_PACKAGE_ID=marblesp_1.0:b6a48e74b3e6028164b2f6e59f6b8fad4bf279b8823e931adf4d9b2507498b6d</span><br><span class="line"></span><br><span class="line">#（9）代表组织Org1批准链码定义。</span><br><span class="line"></span><br><span class="line">export CORE_PEER_LOCALMSPID=&quot;Org1MSP&quot;</span><br><span class="line">export CORE_PEER_TLS_ROOTCERT_FILE=$&#123;PWD&#125;/organizations/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt</span><br><span class="line">export CORE_PEER_MSPCONFIGPATH=$&#123;PWD&#125;/organizations/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp</span><br><span class="line">export CORE_PEER_ADDRESS=localhost:7051</span><br><span class="line">export ORDERER_CA=$&#123;PWD&#125;/organizations/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem</span><br><span class="line">peer lifecycle chaincode approveformyorg -o localhost:7050 --ordererTLSHostnameOverride orderer.example.com --channelID mychannel --name marblesp --version 1.0 --collections-config ../chaincode/marbles02_private/collections_config.json --signature-policy &quot;OR(&#x27;Org1MSP.member&#x27;,&#x27;Org2MSP.member&#x27;)&quot; --package-id $CC_PACKAGE_ID --sequence 1 --tls --cafile $ORDERER_CA</span><br><span class="line"></span><br><span class="line">#（10）代表组织Org2批准链码定义。</span><br><span class="line"></span><br><span class="line">export CORE_PEER_LOCALMSPID=&quot;Org2MSP&quot;</span><br><span class="line">export CORE_PEER_TLS_ROOTCERT_FILE=$&#123;PWD&#125;/organizations/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt</span><br><span class="line">export CORE_PEER_MSPCONFIGPATH=$&#123;PWD&#125;/organizations/peerOrganizations/org2.example.com/users/Admin@org2.example.com/msp</span><br><span class="line">export CORE_PEER_ADDRESS=localhost:9051</span><br><span class="line">peer lifecycle chaincode approveformyorg -o localhost:7050 --ordererTLSHostnameOverride orderer.example.com --channelID mychannel --name marblesp --version 1.0 --collections-config ../chaincode/marbles02_private/collections_config.json --signature-policy &quot;OR(&#x27;Org1MSP.member&#x27;,&#x27;Org2MSP.member&#x27;)&quot; --package-id $CC_PACKAGE_ID --sequence 1 --tls --cafile $ORDERER_CA</span><br><span class="line"></span><br><span class="line">#（11）提交链码定义到通道。现在，组织Org1和Org2都已经批准了链码定义，可以执行如下命令提交链码定义到通道。</span><br><span class="line"></span><br><span class="line">export ORDERER_CA=$&#123;PWD&#125;/organizations/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem</span><br><span class="line">export ORG1_CA=$&#123;PWD&#125;/organizations/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt</span><br><span class="line">export ORG2_CA=$&#123;PWD&#125;/organizations/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt</span><br><span class="line">peer lifecycle chaincode commit -o localhost:7050 --ordererTLSHostnameOverride orderer.example.com --channelID mychannel --name marblesp --version 1.0 --sequence 1 --collections-config ../chaincode/marbles02_private/collections_config.json --signature-policy &quot;OR(&#x27;Org1MSP.member&#x27;,&#x27;Org2MSP.member&#x27;)&quot; --tls --cafile $ORDERER_CA --peerAddresses localhost:7051 --tlsRootCertFiles $ORG1_CA --peerAddresses localhost:9051 --tlsRootCertFiles $ORG2_CA</span><br><span class="line"></span><br><span class="line">#（12）设置环境变量，切换至组织Org1的身份。</span><br><span class="line"></span><br><span class="line">export CORE_PEER_LOCALMSPID=&quot;Org1MSP&quot;</span><br><span class="line">export CORE_PEER_TLS_ROOTCERT_FILE=$&#123;PWD&#125;/organizations/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt</span><br><span class="line">export CORE_PEER_MSPCONFIGPATH=$&#123;PWD&#125;/organizations/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp</span><br><span class="line">export CORE_PEER_ADDRESS=localhost:7051</span><br><span class="line"></span><br><span class="line">#（13）调用链码marblesp的InitMarble()函数，通过命令选项--transient传入暂态数据。</span><br><span class="line"></span><br><span class="line">export MARBLE=$(echo -n &quot;&#123;\&quot;name\&quot;:\&quot;marble1\&quot;,\&quot;color\&quot;:\&quot;blue\&quot;,\&quot;size\&quot;:35,\&quot;owner\&quot;:\&quot;tom\&quot;,\&quot;price\&quot;:99&#125;&quot; | base64 | tr -d \\n)</span><br><span class="line">peer chaincode invoke -o localhost:7050 --ordererTLSHostnameOverride orderer.example.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem -C mychannel -n marblesp -c &#x27;&#123;&quot;Args&quot;:[&quot;InitMarble&quot;]&#125;&#x27; --transient &quot;&#123;\&quot;marble\&quot;:\&quot;$MARBLE\&quot;&#125;&quot;</span><br><span class="line"></span><br><span class="line">#（14）执行如下命令，查询名字为marble1的记录。</span><br><span class="line"></span><br><span class="line">peer chaincode query -C mychannel -n marblesp -c &#x27;&#123;&quot;Args&quot;:[&quot;ReadMarble&quot;,&quot;marble1&quot;]&#125;&#x27;</span><br><span class="line"></span><br><span class="line">#（15）执行如下命令，查询私有数据，执行结果如图9-15所示。</span><br><span class="line"></span><br><span class="line">peer chaincode query -C mychannel -n marblesp -c &#x27;&#123;&quot;Args&quot;:[&quot;ReadMarblePrivateDetails&quot;,&quot;marble1&quot;]&#125;&#x27;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">#simple-contract.go</span><br><span class="line"></span><br><span class="line">package main</span><br><span class="line"></span><br><span class="line">import (</span><br><span class="line">    &quot;errors&quot;</span><br><span class="line">    &quot;fmt&quot;</span><br><span class="line"></span><br><span class="line">    &quot;github.com/hyperledger/fabric-contract-api-go/contractapi&quot;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">// SimpleContract contract for handling writing and reading from the world state</span><br><span class="line">type SimpleContract struct &#123;</span><br><span class="line">    contractapi.Contract</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 在世界状态数据库中添加一个键值对</span><br><span class="line">func (sc *SimpleContract) Create(ctx CustomTransactionContextInterface, key string, value string) error &#123;</span><br><span class="line">    existing := ctx.GetData()</span><br><span class="line"></span><br><span class="line">    if existing != nil &#123;</span><br><span class="line">        return fmt.Errorf(&quot;Cannot create world state pair with key %s. Already exists&quot;, key)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    err := ctx.GetStub().PutState(key, []byte(value))</span><br><span class="line"></span><br><span class="line">    if err != nil &#123;</span><br><span class="line">        return errors.New(&quot;Unable to interact with world state&quot;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    return nil</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 在世界状态数据库中修改指定键的值</span><br><span class="line">func (sc *SimpleContract) Update(ctx CustomTransactionContextInterface, key string, value string) error &#123;</span><br><span class="line">     existing := ctx.GetData()</span><br><span class="line"></span><br><span class="line">    if existing == nil &#123;</span><br><span class="line">        return fmt.Errorf(&quot;Cannot update world state pair with key %s. Does not exist&quot;, key)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    err := ctx.GetStub().PutState(key, []byte(value))</span><br><span class="line"></span><br><span class="line">    if err != nil &#123;</span><br><span class="line">        return errors.New(&quot;Unable to interact with world state&quot;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    return nil</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 从世界状态数据库中根据键读取数据</span><br><span class="line">func (sc *SimpleContract) Read(ctx CustomTransactionContextInterface, key string) (string, error) &#123;</span><br><span class="line">    existing := ctx.GetData()</span><br><span class="line"></span><br><span class="line">    if existing == nil &#123;</span><br><span class="line">        return &quot;&quot;, fmt.Errorf(&quot;Cannot read world state pair with key %s. Does not exist&quot;, key)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    return string(existing), nil</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">#main.go</span><br><span class="line"></span><br><span class="line">package main</span><br><span class="line"></span><br><span class="line">import (</span><br><span class="line">    &quot;errors&quot;</span><br><span class="line">    &quot;github.com/hyperledger/fabric-contract-api-go/contractapi&quot;</span><br><span class="line">)</span><br><span class="line">//交易前处理函数</span><br><span class="line">func GetWorldState(ctx CustomTransactionContextInterface) error &#123;</span><br><span class="line">  _, params := ctx.GetStub().GetFunctionAndParameters()</span><br><span class="line"></span><br><span class="line">  if len(params) &lt; 1 &#123;</span><br><span class="line">    return errors.New(&quot;Missing key for world state&quot;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  existing, err := ctx.GetStub().GetState(params[0])</span><br><span class="line"></span><br><span class="line">  if err != nil &#123;</span><br><span class="line">    return errors.New(&quot;Unable to interact with world state&quot;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  ctx.SetData(existing)</span><br><span class="line"></span><br><span class="line">  return nil</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func main() &#123;</span><br><span class="line">   simpleContract := new(SimpleContract)</span><br><span class="line">  simpleContract.BeforeTransaction = GetWorldState</span><br><span class="line">   simpleContract.TransactionContextHandler = new(CustomTransactionContext)</span><br><span class="line">    cc, err := contractapi.NewChaincode(simpleContract)</span><br><span class="line"></span><br><span class="line">    if err != nil &#123;</span><br><span class="line">        panic(err.Error())</span><br><span class="line">    &#125;</span><br><span class="line">   if err := cc.Start(); err != nil &#123;</span><br><span class="line">        panic(err.Error())</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">#transaction-context.go</span><br><span class="line"></span><br><span class="line">package main</span><br><span class="line"></span><br><span class="line">import (</span><br><span class="line">  &quot;github.com/hyperledger/fabric-contract-api-go/contractapi&quot;</span><br><span class="line">)</span><br><span class="line">//定义接口CustomTransactionContextInterface，指定自定义交易上下文对象的结构体中必须实现的函数</span><br><span class="line">type CustomTransactionContextInterface interface &#123;</span><br><span class="line">  contractapi.TransactionContextInterface</span><br><span class="line">  GetData() []byte</span><br><span class="line">  SetData([]byte)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// 自定义交易上下文对象</span><br><span class="line">type CustomTransactionContext struct &#123;</span><br><span class="line">  contractapi.TransactionContext</span><br><span class="line">  data []byte</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// GetData return set data</span><br><span class="line">func (ctc *CustomTransactionContext) GetData() []byte &#123;</span><br><span class="line">  return ctc.data</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// SetData provide a value for data</span><br><span class="line">func (ctc *CustomTransactionContext) SetData(data []byte) &#123;</span><br><span class="line">  ctc.data = data</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="10">10</h2>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">#下载Fabric SDK Go</span><br><span class="line">cd $GOPATH/src/github.com/hyperledger</span><br><span class="line">git clone https://github.com/hyperledger/fabric-sdk-go.git</span><br><span class="line"></span><br><span class="line">#检出最新代码</span><br><span class="line">cd $GOPATH/src/github.com/hyperledger/fabric-sdk-go</span><br><span class="line">git checkout 614551a752802488988921a730b172dada7def1d</span><br><span class="line"></span><br><span class="line">#2．安装Fabric SDK Go的依赖包</span><br><span class="line">cd $GOPATH/src/github.com/hyperledger/fabric-sdk-go</span><br><span class="line">export GOPROXY=https://goproxy.cn</span><br><span class="line">export GO111MODULE=on</span><br><span class="line">make depend</span><br><span class="line">make depend-install</span><br><span class="line"></span><br><span class="line">#手动生成相关依赖包</span><br><span class="line">#手动下载gocov</span><br><span class="line">go get -u github.com/axw/gocov/</span><br><span class="line">#手动安装gocov</span><br><span class="line">cd $GOPATH/src/github.com/axw/gocov/</span><br><span class="line">go install</span><br><span class="line"></span><br><span class="line">#手动安装dep</span><br><span class="line">export GO111MODULE=on</span><br><span class="line">go env -w GOPROXY=https://goproxy.cn</span><br><span class="line">go get -u github.com/golang/dep/cmd/dep</span><br><span class="line"></span><br><span class="line">#（1）启动测试网络</span><br><span class="line">cd /$GOPATH/src/github.com/hyperledger/fabric/scripts/fabric-samples/test-network</span><br><span class="line">./network.sh up createChannel -ca</span><br><span class="line"></span><br><span class="line">#（2）部署智能合约</span><br><span class="line">./network.sh deployCC -ccn basic -ccp ../asset-transfer-basic/chaincode-go -ccl go</span><br><span class="line"></span><br><span class="line">#（3）运行示例程序assetTransfer.go</span><br><span class="line">cd ../ asset-transfer-basic/application-go</span><br><span class="line">go run assetTransfer.go</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://timefy.github.io">水木时</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://timefy.github.io/posts/3f4ab5ae.html">https://timefy.github.io/posts/3f4ab5ae.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://timefy.github.io" target="_blank">水木时</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E6%9D%82%E8%AE%B0/">杂记</a><a class="post-meta__tags" href="/tags/%E5%8C%BA%E5%9D%97%E9%93%BE/">区块链</a></div><div class="post_share"><div class="social-share" data-image="/img/img/23.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/c4046440.html" title="历史归档"><img class="cover" src="/img/img/24.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">历史归档</div></div></a></div><div class="next-post pull-right"><a href="/posts/8bae2eef.html" title="WSL导盘"><img class="cover" src="/img/img/22.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">WSL导盘</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/posts/76781db4.html" title="VMware中扩展Ubuntu虚拟机的磁盘空间"><img class="cover" src="/img/img/26.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-08-14</div><div class="title">VMware中扩展Ubuntu虚拟机的磁盘空间</div></div></a></div><div><a href="/posts/143483fc.html" title="Kali安装无线网卡Realtek-RTL8188eu（0bda:8179芯片）驱动"><img class="cover" src="/img/img/27.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-09-27</div><div class="title">Kali安装无线网卡Realtek-RTL8188eu（0bda:8179芯片）驱动</div></div></a></div><div><a href="/posts/8bae2eef.html" title="WSL导盘"><img class="cover" src="/img/img/22.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-05-25</div><div class="title">WSL导盘</div></div></a></div><div><a href="/posts/4e548ddc.html" title="在WSL2中删除文件后，磁盘空间未释放"><img class="cover" src="/img/img/28.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-09-27</div><div class="title">在WSL2中删除文件后，磁盘空间未释放</div></div></a></div><div><a href="/posts/c4046440.html" title="历史归档"><img class="cover" src="/img/img/24.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-07-05</div><div class="title">历史归档</div></div></a></div><div><a href="/posts/59996274.html" title="解决启动Vmware都要重置网卡设置，否则无法上网的问题"><img class="cover" src="/img/img/29.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-09-27</div><div class="title">解决启动Vmware都要重置网卡设置，否则无法上网的问题</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/img.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">水木时</div><div class="author-info__description">以其德，悟其道</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">25</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">16</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">5</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/timefy"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">以德立身，融道于行</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">1.</span> <span class="toc-text">知识记录</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%A4%E6%98%93%E6%B5%81%E7%A8%8B"><span class="toc-number">1.1.</span> <span class="toc-text">交易流程</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%A6%E7%BB%86%E7%9A%84%E4%BA%A4%E6%98%93%E8%BF%87%E7%A8%8B"><span class="toc-number">1.1.1.</span> <span class="toc-text">详细的交易过程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%8C%E6%95%B4%E7%9A%84%E4%BA%A4%E6%98%93%E8%BF%87%E7%A8%8B"><span class="toc-number">1.1.2.</span> <span class="toc-text">完整的交易过程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%A6%E6%9C%89%E7%A7%81%E6%9C%89%E6%95%B0%E6%8D%AE%E7%9A%84%E4%BA%A4%E6%98%93%E6%B5%81"><span class="toc-number">1.1.3.</span> <span class="toc-text">带有私有数据的交易流</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%A4%E6%98%93%E6%A8%A1%E6%8B%9F%E5%92%8C%E8%AF%BB-%E5%86%99%E9%9B%86"><span class="toc-number">1.1.4.</span> <span class="toc-text">交易模拟和读&#x2F;写集</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%83%A8%E7%BD%B2Fabric%E7%94%9F%E4%BA%A7%E7%BD%91%E7%BB%9C"><span class="toc-number">1.2.</span> <span class="toc-text">部署Fabric生产网络</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AD%A5%E9%AA%A4"><span class="toc-number">1.2.1.</span> <span class="toc-text">步骤</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BE%E8%AE%A1%E7%94%9F%E4%BA%A7%E7%BD%91%E7%BB%9C%E7%9A%84%E7%BB%93%E6%9E%84%E5%92%8C%E9%85%8D%E7%BD%AE"><span class="toc-number">1.2.2.</span> <span class="toc-text">设计生产网络的结构和配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%A8%E7%94%9F%E4%BA%A7%E7%BD%91%E7%BB%9C%E4%B8%AD%E9%83%A8%E7%BD%B2Fabric%E5%8C%BA%E5%9D%97%E9%93%BE%E7%9A%84%E5%90%84%E7%BB%84%E4%BB%B6"><span class="toc-number">1.2.3.</span> <span class="toc-text">在生产网络中部署Fabric区块链的各组件</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E8%B5%84%E6%BA%90%E9%9B%86%E7%BE%A4"><span class="toc-number">1.2.3.1.</span> <span class="toc-text">创建资源集群</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%90%AD%E5%BB%BA-CA"><span class="toc-number">1.2.3.2.</span> <span class="toc-text">搭建 CA</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8CA%E5%88%9B%E5%BB%BA%E8%BA%AB%E4%BB%BD%E5%92%8CMSP"><span class="toc-number">1.2.3.3.</span> <span class="toc-text">使用CA创建身份和MSP</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%83%A8%E7%BD%B2Peer%E8%8A%82%E7%82%B9"><span class="toc-number">1.2.3.4.</span> <span class="toc-text">部署Peer节点</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%83%A8%E7%BD%B2%E6%8E%92%E5%BA%8F%E8%8A%82%E7%82%B9"><span class="toc-number">1.2.3.5.</span> <span class="toc-text">部署排序节点</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">2.</span> <span class="toc-text">实验记录</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#CentOS7-9-GLIBC-2-28-not-found"><span class="toc-number">2.1.</span> <span class="toc-text">CentOS7.9 GLIBC_2.28 not found</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85C-compliler"><span class="toc-number">2.1.1.</span> <span class="toc-text">安装C compliler</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8D%87%E7%BA%A7GCC%E7%BC%96%E8%AF%91%E5%99%A8"><span class="toc-number">2.1.2.</span> <span class="toc-text">升级GCC编译器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8D%87%E7%BA%A7make"><span class="toc-number">2.1.3.</span> <span class="toc-text">升级make</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8D%87%E7%BA%A7glic-2-28"><span class="toc-number">2.1.4.</span> <span class="toc-text">升级glic-2.28</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#mysql%E6%97%A0%E6%B3%95%E5%BC%80%E5%90%AF"><span class="toc-number">2.2.</span> <span class="toc-text">mysql无法开启</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#systemctl-status-mysqld"><span class="toc-number">2.2.1.</span> <span class="toc-text">systemctl status mysqld</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#cat-var-log-mysqld-log"><span class="toc-number">2.2.2.</span> <span class="toc-text">cat &#x2F;var&#x2F;log&#x2F;mysqld.log</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88"><span class="toc-number">2.2.3.</span> <span class="toc-text">解决方案</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#x509%EF%BC%9AECDSA-verification-failure%E6%8A%A5%E9%94%99"><span class="toc-number">2.3.</span> <span class="toc-text">x509：ECDSA verification failure报错</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8A%A5%E9%94%99%E4%BF%A1%E6%81%AF"><span class="toc-number">2.3.1.</span> <span class="toc-text">报错信息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8E%9F%E5%9B%A0"><span class="toc-number">2.3.2.</span> <span class="toc-text">原因</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#failed-0-sub-policies-were-satisfied-but-this-policy-requires-1-of-the-%E2%80%98Writers%E2%80%99-sub-policies-to-be-satisfied-permission-denied"><span class="toc-number">2.4.</span> <span class="toc-text">failed - 0 sub-policies were satisfied, but this policy requires 1 of the ‘Writers’ sub-policies to be satisfied: permission denied</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8E%9F%E5%9B%A0-2"><span class="toc-number">2.4.1.</span> <span class="toc-text">原因</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8A%A5%E9%94%99%E4%BF%A1%E6%81%AF-2"><span class="toc-number">2.4.2.</span> <span class="toc-text">报错信息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%881"><span class="toc-number">2.4.3.</span> <span class="toc-text">解决方案1</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%882"><span class="toc-number">2.4.4.</span> <span class="toc-text">解决方案2</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">3.</span> <span class="toc-text">章节资料</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#03"><span class="toc-number">3.1.</span> <span class="toc-text">03</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#04"><span class="toc-number">3.2.</span> <span class="toc-text">04</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#05"><span class="toc-number">3.3.</span> <span class="toc-text">05</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#06"><span class="toc-number">3.4.</span> <span class="toc-text">06</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#07"><span class="toc-number">3.5.</span> <span class="toc-text">07</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#09"><span class="toc-number">3.6.</span> <span class="toc-text">09</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10"><span class="toc-number">3.7.</span> <span class="toc-text">10</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/59996274.html" title="解决启动Vmware都要重置网卡设置，否则无法上网的问题"><img src="/img/img/29.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="解决启动Vmware都要重置网卡设置，否则无法上网的问题"/></a><div class="content"><a class="title" href="/posts/59996274.html" title="解决启动Vmware都要重置网卡设置，否则无法上网的问题">解决启动Vmware都要重置网卡设置，否则无法上网的问题</a><time datetime="2024-09-27T14:32:12.000Z" title="发表于 2024-09-27 22:32:12">2024-09-27</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/4e548ddc.html" title="在WSL2中删除文件后，磁盘空间未释放"><img src="/img/img/28.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="在WSL2中删除文件后，磁盘空间未释放"/></a><div class="content"><a class="title" href="/posts/4e548ddc.html" title="在WSL2中删除文件后，磁盘空间未释放">在WSL2中删除文件后，磁盘空间未释放</a><time datetime="2024-09-27T14:32:11.000Z" title="发表于 2024-09-27 22:32:11">2024-09-27</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/143483fc.html" title="Kali安装无线网卡Realtek-RTL8188eu（0bda:8179芯片）驱动"><img src="/img/img/27.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Kali安装无线网卡Realtek-RTL8188eu（0bda:8179芯片）驱动"/></a><div class="content"><a class="title" href="/posts/143483fc.html" title="Kali安装无线网卡Realtek-RTL8188eu（0bda:8179芯片）驱动">Kali安装无线网卡Realtek-RTL8188eu（0bda:8179芯片）驱动</a><time datetime="2024-09-27T14:32:10.000Z" title="发表于 2024-09-27 22:32:10">2024-09-27</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/76781db4.html" title="VMware中扩展Ubuntu虚拟机的磁盘空间"><img src="/img/img/26.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="VMware中扩展Ubuntu虚拟机的磁盘空间"/></a><div class="content"><a class="title" href="/posts/76781db4.html" title="VMware中扩展Ubuntu虚拟机的磁盘空间">VMware中扩展Ubuntu虚拟机的磁盘空间</a><time datetime="2024-08-14T08:02:47.000Z" title="发表于 2024-08-14 16:02:47">2024-08-14</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/bb1666b8.html" title="林建入_《区块链实验课》"><img src="/img/img/25.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="林建入_《区块链实验课》"/></a><div class="content"><a class="title" href="/posts/bb1666b8.html" title="林建入_《区块链实验课》">林建入_《区块链实验课》</a><time datetime="2024-07-05T10:09:07.000Z" title="发表于 2024-07-05 18:09:07">2024-07-05</time></div></div></div></div></div></div></main><footer id="footer" style="background: transparent"><div id="footer-wrap"><div class="copyright">&copy;2023 - 2025 By 水木时</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.autoSpacingPage()
  else {
    getScript('https://cdn.jsdelivr.net/npm/pangu/dist/browser/pangu.min.js')
      .then(() => {
        pangu.autoSpacingPage()
      })
  }
}

function panguInit () {
  if (false){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><div class="js-pjax"></div><script id="click-heart" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/click-heart.min.js" async="async" mobile="false"></script><script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {

  // removeEventListener
  btf.removeGlobalFnEvent('pjax')
  btf.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

  typeof disqusjs === 'object' && disqusjs.destroy()
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div></body></html>